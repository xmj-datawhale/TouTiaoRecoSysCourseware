<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>离线文章画像计算 | 黑马头条推荐系统项目课程定位、目标</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.6.7">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../gitbook/style.css">
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-katex/katex.min.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    

        
    
    
    <link rel="next" href="../day01/section4.html" />
    
    
    <link rel="prev" href="../day01/section2.html" />
    

        
    </head>
    <body>
        
        
    <div class="book"
        data-level="2.4"
        data-chapter-title="离线文章画像计算"
        data-filepath="day01/section3.md"
        data-basepath=".."
        data-revision="Wed Jun 05 2019 18:41:21 GMT+0800 (CST)"
        data-innerlanguage="">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        黑马头条推荐系统项目
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="reco/index.html">
            
                
                    <a href="../reco/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        黑马头条推荐架构介绍
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="reco/section1.html">
            
                
                    <a href="../reco/section1.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        头条推荐架构
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="reco/section2.html">
            
                
                    <a href="../reco/section2.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                        开发环境介绍
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="day01/index.html">
            
                
                    <a href="../day01/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        离线计算更新文章画像
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="day01/section0.html">
            
                
                    <a href="../day01/section0.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        数据库迁移
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="day01/section1.html">
            
                
                    <a href="../day01/section1.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                        用户行为收集到HIVE
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="day01/section2.html">
            
                
                    <a href="../day01/section2.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.3.</b>
                        
                        离线画像业务介绍
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="2.4" data-path="day01/section3.html">
            
                
                    <a href="../day01/section3.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.4.</b>
                        
                        离线文章画像计算
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="day01/section4.html">
            
                
                    <a href="../day01/section4.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.5.</b>
                        
                        离线增量画像更新代码
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="day01/section5.html">
            
                
                    <a href="../day01/section5.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.6.</b>
                        
                        Apscheduler定时更新文章画像
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.7" data-path="day01/section6.html">
            
                
                    <a href="../day01/section6.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.7.</b>
                        
                        Word2Vec与文章相似度
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.8" data-path="day01/section7.html">
            
                
                    <a href="../day01/section7.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.8.</b>
                        
                        文章相似度增量更新
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.9" data-path="day01/section8.html">
            
                
                    <a href="../day01/section8.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.9.</b>
                        
                        总结
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.10" data-path="day01/section9.html">
            
                
                    <a href="../day01/section9.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.10.</b>
                        
                        每日作业
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3" data-path="day02/index.html">
            
                
                    <a href="../day02/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        离线用户画像更新与召回排序计算
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1" data-path="day02/section1.html">
            
                
                    <a href="../day02/section1.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                        用户画像逻辑
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="day02/section2.html">
            
                
                    <a href="../day02/section2.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.</b>
                        
                        用户画像增量更新
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="day02/section3.html">
            
                
                    <a href="../day02/section3.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.</b>
                        
                        离线召回与排序介绍
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="day02/section4.html">
            
                
                    <a href="../day02/section4.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.4.</b>
                        
                        离线用户基于模型召回集
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="day02/section5.html">
            
                
                    <a href="../day02/section5.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.5.</b>
                        
                        离线用户基于内容召回集
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.6" data-path="day02/section6.html">
            
                
                    <a href="../day02/section6.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.6.</b>
                        
                        离线用户召回定时更新
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.7" data-path="day02/section7.html">
            
                
                    <a href="../day02/section7.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.7.</b>
                        
                        离线排序模型训练基础
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.8" data-path="day02/section8.html">
            
                
                    <a href="../day02/section8.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.8.</b>
                        
                        离线ctr特征中心更新
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.9" data-path="day02/section9.html">
            
                
                    <a href="../day02/section9.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.9.</b>
                        
                        总结
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.10" data-path="day02/section10.html">
            
                
                    <a href="../day02/section10.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.10.</b>
                        
                        每日作业
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4" data-path="day03/index.html">
            
                
                    <a href="../day03/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        实时计算业务
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1" data-path="day03/section0.html">
            
                
                    <a href="../day03/section0.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                        实时计算业务介绍
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="day03/section1.html">
            
                
                    <a href="../day03/section1.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.</b>
                        
                        实时日志分析
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="day03/section2.html">
            
                
                    <a href="../day03/section2.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.3.</b>
                        
                        实时召回集业务
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.4" data-path="day03/section3.html">
            
                
                    <a href="../day03/section3.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.4.</b>
                        
                        热门与新文章召回
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.5" data-path="day03/section4.html">
            
                
                    <a href="../day03/section4.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.5.</b>
                        
                        总结
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.6" data-path="day03/section5.html">
            
                
                    <a href="../day03/section5.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.6.</b>
                        
                        每日作业
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5" data-path="day04/index.html">
            
                
                    <a href="../day04/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        推荐业务流实现与ABTest
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1" data-path="day04/section0.html">
            
                
                    <a href="../day04/section0.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.1.</b>
                        
                        实时推荐业务介绍
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="day04/section1.html">
            
                
                    <a href="../day04/section1.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.2.</b>
                        
                        grpc接口对接
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="day04/section2.html">
            
                
                    <a href="../day04/section2.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.3.</b>
                        
                        ABTest实验中心
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.4" data-path="day04/section3.html">
            
                
                    <a href="../day04/section3.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.4.</b>
                        
                        推荐中心逻辑
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.5" data-path="day04/section4.html">
            
                
                    <a href="../day04/section4.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.5.</b>
                        
                        召回集读取服务
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.6" data-path="day04/section5.html">
            
                
                    <a href="../day04/section5.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.6.</b>
                        
                        推荐缓存服务
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.7" data-path="day04/section6.html">
            
                
                    <a href="../day04/section6.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.7.</b>
                        
                        排序模型在线预测
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.8" data-path="day04/section7.html">
            
                
                    <a href="../day04/section7.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.8.</b>
                        
                        总结
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.9" data-path="day04/section8.html">
            
                
                    <a href="../day04/section8.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.9.</b>
                        
                        每日作业
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6" data-path="day05/index.html">
            
                
                    <a href="../day05/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        深度学习与推荐系统
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1" data-path="day05/section1.html">
            
                
                    <a href="../day05/section1.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.1.</b>
                        
                        推荐系统的深度学习关联
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.2" data-path="day05/section2.html">
            
                
                    <a href="../day05/section2.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.2.</b>
                        
                        深度学习应用简介
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="7" data-path="day06/index.html">
            
                
                    <a href="../day06/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                        TensorFlow框架介绍
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="7.1" data-path="day06/section1.html">
            
                
                    <a href="../day06/section1.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.1.</b>
                        
                        TF数据流图
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.2" data-path="day06/section2.html">
            
                
                    <a href="../day06/section2.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.2.</b>
                        
                        图与TensorBoard
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.3" data-path="day06/section3.html">
            
                
                    <a href="../day06/section3.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.3.</b>
                        
                        会话、张量、变量OP
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.4" data-path="day06/section4.html">
            
                
                    <a href="../day06/section4.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.4.</b>
                        
                        案例：TensorFlow实现线性回归
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.5" data-path="day06/section5.html">
            
                
                    <a href="../day06/section5.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.5.</b>
                        
                        TFAPI使用2.0建议
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.6" data-path="day06/section6.html">
            
                
                    <a href="../day06/section6.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.6.</b>
                        
                        tf.estimator使用
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.7" data-path="day06/section7.html">
            
                
                    <a href="../day06/section7.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.7.</b>
                        
                        总结
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.8" data-path="day06/section8.html">
            
                
                    <a href="../day06/section8.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.8.</b>
                        
                        每日作业
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="8" data-path="day07/index.html">
            
                
                    <a href="../day07/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.</b>
                        
                        黑马头条排序模型进阶
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="8.1" data-path="day07/section1.html">
            
                
                    <a href="../day07/section1.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.1.</b>
                        
                        神经网络基础与原理
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.2" data-path="day07/section2.html">
            
                
                    <a href="../day07/section2.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.2.</b>
                        
                        tf.data与tf.feature_column
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.3" data-path="day07/section3.html">
            
                
                    <a href="../day07/section3.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.3.</b>
                        
                        案例：DNN文本分类与word2vec原理
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.4" data-path="day07/section4.html">
            
                
                    <a href="../day07/section4.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.4.</b>
                        
                        TFRecords与黑马训练数据存储
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.5" data-path="day07/section5.html">
            
                
                    <a href="../day07/section5.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.5.</b>
                        
                        深度学习与排序模型发展
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.6" data-path="day07/section6.html">
            
                
                    <a href="../day07/section6.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.6.</b>
                        
                        分桶与特征交叉
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.7" data-path="day07/section7.html">
            
                
                    <a href="../day07/section7.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.7.</b>
                        
                        黑马排序模型进阶-FTRL on Tensorflow
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.8" data-path="day07/section8.html">
            
                
                    <a href="../day07/section8.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.8.</b>
                        
                        黑马排序模型进阶-Wide&amp;Deep
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.9" data-path="day07/section9.html">
            
                
                    <a href="../day07/section9.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.9.</b>
                        
                        WDL模型导出
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.10" data-path="day07/section10.html">
            
                
                    <a href="../day07/section10.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.10.</b>
                        
                        TensorFlow Serving模型部署
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.11" data-path="day07/section11.html">
            
                
                    <a href="../day07/section11.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.11.</b>
                        
                        排序模型在线测试
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.12" data-path="day07/section12.html">
            
                
                    <a href="../day07/section12.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.12.</b>
                        
                        总结
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.13" data-path="day07/section13.html">
            
                
                    <a href="../day07/section13.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.13.</b>
                        
                        每日作业
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >黑马头条推荐系统项目课程定位、目标</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="24-&#x79BB;&#x7EBF;&#x6587;&#x7AE0;&#x753B;&#x50CF;&#x8BA1;&#x7B97;">2.4 &#x79BB;&#x7EBF;&#x6587;&#x7AE0;&#x753B;&#x50CF;&#x8BA1;&#x7B97;</h1>
<h2 id="&#x5B66;&#x4E60;&#x76EE;&#x6807;">&#x5B66;&#x4E60;&#x76EE;&#x6807;</h2>
<ul>
<li>&#x76EE;&#x6807;<ul>
<li>&#x4E86;&#x89E3;&#x6587;&#x7AE0;&#x753B;&#x50CF;&#x6784;&#x6210;</li>
<li>&#x77E5;&#x9053;spark tfidf&#x4EE5;&#x53CA;TextRank&#x8BA1;&#x7B97;&#x5DE5;&#x5177;&#x4F7F;&#x7528;</li>
<li>&#x77E5;&#x9053;&#x6587;&#x7AE0;&#x753B;&#x50CF;&#x7684;&#x8BA1;&#x7B97;&#x548C;&#x6784;&#x5EFA;</li>
</ul>
</li>
<li>&#x5E94;&#x7528;<ul>
<li>&#x5E94;&#x7528;spark&#x5B8C;&#x6210;&#x6587;&#x7AE0;Tfidf&#x503C;&#x8BA1;&#x7B97;</li>
<li>&#x5E94;&#x7528;spark&#x5B8C;&#x6210;&#x6587;&#x7AE0;TextRank&#x503C;&#x8BA1;&#x7B97;</li>
<li>&#x5E94;&#x7528;spark&#x5B8C;&#x6210;&#x6587;&#x7AE0;&#x753B;&#x50CF;&#x7ED3;&#x679C;&#x503C;&#x8BA1;&#x7B97;&#x4E0E;&#x5B58;&#x50A8;</li>
</ul>
</li>
</ul>
<p>&#x5DE5;&#x7A0B;&#x76EE;&#x5F55;&#x5982;&#x4E0B;</p>
<p><img src="../images/&#x76EE;&#x5F55;&#x7ED3;&#x6784;1.png" alt=""></p>
<h3 id="&#x79BB;&#x7EBF;&#x6587;&#x7AE0;&#x753B;&#x50CF;&#x7EC4;&#x6210;&#x9700;&#x6C42;">&#x79BB;&#x7EBF;&#x6587;&#x7AE0;&#x753B;&#x50CF;&#x7EC4;&#x6210;&#x9700;&#x6C42;</h3>
<p>&#x6587;&#x7AE0;&#x753B;&#x50CF;&#xFF0C;&#x5C31;&#x662F;&#x7ED9;&#x6BCF;&#x7BC7;&#x6587;&#x7AE0;&#x5B9A;&#x4E49;&#x4E00;&#x4E9B;&#x8BCD;&#x3002;&#x4E3B;&#x9898;&#x8BCD;&#x4E0E;&#x5173;&#x952E;&#x8BCD;&#x6700;&#x5927;&#x7684;&#x533A;&#x522B;&#x5C31;&#x662F;&#x4E3B;&#x9898;&#x8BCD;&#x7ECF;&#x8FC7;&#x4E86;&#x89C4;&#x8303;&#x5316;&#x5904;&#x7406;&#x3002;</p>
<p>&#x5173;&#x952E;&#x8BCD;&#xFF1A;&#x6587;&#x7AE0;&#x4E2D;&#x4E00;&#x4E9B;&#x8BCD;&#x7684;&#x6743;&#x91CD;&#x9AD8;&#x7684;&#x3002;&#x4E3B;&#x9898;&#x8BCD;&#xFF1A;&#x662F;&#x8FDB;&#x884C;&#x89C4;&#x8303;&#x5316;&#x5904;&#x7406;&#x7684;&#xFF0C;&#x6587;&#x7AE0;&#x4E2D;&#x51FA;&#x73B0;&#x7684;&#x540C;&#x4E49;&#x8BCD;&#xFF0C;&#x8BA1;&#x7B97;&#x7ED3;&#x679C;&#x51FA;&#x73B0;&#x6B21;&#x6570;&#x9AD8;&#x7684;&#x8BCD;&#x3002;</p>
<ul>
<li>&#x5173;&#x952E;&#x8BCD;&#xFF1A;TEXTRANK&#x8BA1;&#x7B97;&#x51FA;&#x7684;&#x7ED3;&#x679C;TOPK&#x4E2A;&#x8BCD;&#x4EE5;&#x53CA;&#x6743;&#x91CD;</li>
<li>&#x4E3B;&#x9898;&#x8BCD;&#xFF1A;TEXTRANK&#x7684;TOPK&#x8BCD; &#x4E0E; ITFDF&#x8BA1;&#x7B97;&#x7684;TOPK&#x4E2A;&#x8BCD;&#x7684;&#x4EA4;&#x96C6;</li>
</ul>
<p>&#x67E5;&#x770B;&#x7ED3;&#x679C;&#xFF1A;</p>
<pre><code class="lang-mysql">hive&gt; desc article_profile;
OK
article_id              int                     article_id          
channel_id              int                     channel_id          
keywords                map<string,double>      keywords            
topics                  array<string>           topics      

hive&gt; select * from article_profile limit 1;
OK
26      17      {&quot;&#x7B56;&#x7565;&quot;:0.3973770571351729,&quot;jpg&quot;:0.9806348975390871,&quot;&#x7528;&#x6237;&quot;:1.2794959063944176,&quot;strong&quot;:1.6488457985625076,&quot;&#x6587;&#x4EF6;&quot;:0.28144603583387057,&quot;&#x903B;&#x8F91;&quot;:0.45256526469610714,&quot;&#x5F62;&#x5F0F;&quot;:0.4123994242601279,&quot;&#x5168;&#x81EA;&quot;:0.9594604850547191,&quot;h2&quot;:0.6244481634710125,&quot;&#x7248;&#x672C;&quot;:0.44280276959510817,&quot;Adobe&quot;:0.8553618185108718,&quot;&#x5B89;&#x88C5;&quot;:0.8305037437573172,&quot;&#x68C0;&#x67E5;&#x66F4;&#x65B0;&quot;:1.8088946300014435,&quot;&#x4EA7;&#x54C1;&quot;:0.774842382276899,&quot;&#x4E0B;&#x8F7D;&#x9875;&quot;:1.4256311032544344,&quot;&#x8FC7;&#x7A0B;&quot;:0.19827163395829256,&quot;json&quot;:0.6423301791599972,&quot;&#x65B9;&#x5F0F;&quot;:0.582762869780791,&quot;&#x9000;&#x51FA;&#x5E94;&#x7528;&quot;:1.2338671268242603,&quot;Setup&quot;:1.004399549339134}   [&quot;Electron&quot;,&quot;&#x5168;&#x81EA;&#x52A8;&quot;,&quot;&#x4EA7;&#x54C1;&quot;,&quot;&#x7248;&#x672C;&#x53F7;&quot;,&quot;&#x5B89;&#x88C5;&#x5305;&quot;,&quot;&#x68C0;&#x67E5;&#x66F4;&#x65B0;&quot;,&quot;&#x65B9;&#x6848;&quot;,&quot;&#x7248;&#x672C;&quot;,&quot;&#x9000;&#x51FA;&#x5E94;&#x7528;&quot;,&quot;&#x903B;&#x8F91;&quot;,&quot;&#x5B89;&#x88C5;&#x8FC7;&#x7A0B;&quot;,&quot;&#x65B9;&#x5F0F;&quot;,&quot;&#x5B9A;&#x6027;&quot;,&quot;&#x65B0;&#x7248;&#x672C;&quot;,&quot;Setup&quot;,&quot;&#x9759;&#x9ED8;&quot;,&quot;&#x7528;&#x6237;&quot;]
Time taken: 0.322 seconds, Fetched: 1 row(s)
</string></string,double></code></pre>
<p><strong>&#x6B65;&#x9AA4;&#xFF1A;</strong></p>
<p><strong>1&#x3001;&#x539F;&#x59CB;&#x6587;&#x7AE0;&#x8868;&#x6570;&#x636E;&#x5408;&#x5E76;&#x5F97;&#x5230;&#x6587;&#x7AE0;&#x6240;&#x6709;&#x7684;&#x8BCD;&#x8BED;&#x53E5;&#x4FE1;&#x606F;</strong></p>
<ul>
<li>&#x6587;&#x7AE0;&#x6807;&#x9898;+&#x6587;&#x7AE0;&#x9891;&#x9053;&#x540D;&#x79F0;+&#x6587;&#x7AE0;&#x5185;&#x5BB9;&#x7EC4;&#x6210;&#x6587;&#x7AE0;&#x5B8C;&#x6574;&#x5185;&#x5BB9;</li>
</ul>
<p><strong>2&#x3001;&#x6240;&#x6709;&#x5386;&#x53F2;&#x6587;&#x7AE0;Tfidf&#x8BA1;&#x7B97;</strong></p>
<p><strong>3&#x3001;&#x6240;&#x6709;&#x5386;&#x53F2;&#x6587;&#x7AE0;TextRank&#x8BA1;&#x7B97;</strong></p>
<h3 id="241-&#x539F;&#x59CB;&#x6587;&#x7AE0;&#x6570;&#x636E;&#x7684;&#x5408;&#x5E76;">2.4.1 &#x539F;&#x59CB;&#x6587;&#x7AE0;&#x6570;&#x636E;&#x7684;&#x5408;&#x5E76;</h3>
<p>&#x4E3A;&#x4E86;&#x65B9;&#x4FBF;&#x4E0E;&#x8FDB;&#x884C;&#x6587;&#x7AE0;&#x6570;&#x636E;&#x64CD;&#x4F5C;&#xFF0C;&#x5C06;&#x6587;&#x7AE0;&#x76F8;&#x5173;&#x91CD;&#x8981;&#x4FE1;&#x606F;&#x8868;&#x5408;&#x5E76;&#x5728;&#x4E00;&#x8D77;&#x3002;&#x901A;&#x8FC7;spark sql &#x6765;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;</p>
<ul>
<li>&#x6B65;&#x9AA4;&#xFF1A;<ul>
<li>&#x521B;&#x5EFA;Spark&#x521D;&#x59CB;&#x5316;&#x76F8;&#x5173;&#x914D;&#x7F6E;</li>
<li>&#x8FDB;&#x884C;&#x5408;&#x5E76;&#x8BA1;&#x7B97;&#xFF0C;&#x5408;&#x5E76;&#x7ED3;&#x679C;</li>
</ul>
</li>
</ul>
<h4 id="2411-&#x521B;&#x5EFA;spark&#x521D;&#x59CB;&#x5316;&#x76F8;&#x5173;&#x914D;&#x7F6E;">2.4.1.1 &#x521B;&#x5EFA;Spark&#x521D;&#x59CB;&#x5316;&#x76F8;&#x5173;&#x914D;&#x7F6E;</h4>
<p>&#x5728;_<em>init_</em>&#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x7ECF;&#x5E38;&#x7528;&#x5230;&#x7684;&#x57FA;&#x7C7B;</p>
<ul>
<li>&#x5B9A;&#x4E49;&#x597D;spark&#x542F;&#x52A8;&#x7684;&#x7C7B;&#x522B;&#xFF0C;&#x4EE5;&#x53CA;&#x76F8;&#x5173;&#x5185;&#x5B58;&#x8BBE;&#x7F6E;</li>
</ul>
<pre><code class="lang-python">SPARK_APP_NAME = <span class="hljs-keyword">None</span> <span class="hljs-comment"># APP&#x7684;&#x540D;&#x5B57;</span>
SPARK_URL = <span class="hljs-string">&quot;yarn&quot;</span> <span class="hljs-comment"># &#x542F;&#x52A8;&#x8FD0;&#x884C;&#x65B9;&#x5F0F;</span>

SPARK_EXECUTOR_MEMORY = <span class="hljs-string">&quot;2g&quot;</span> <span class="hljs-comment"># &#x6267;&#x884C;&#x5185;&#x5B58;</span>
SPARK_EXECUTOR_CORES = <span class="hljs-number">2</span> <span class="hljs-comment"># &#x6BCF;&#x4E2A;EXECUTOR&#x80FD;&#x591F;&#x4F7F;&#x7528;&#x7684;CPU core&#x7684;&#x6570;&#x91CF;</span>
SPARK_EXECUTOR_INSTANCES = <span class="hljs-number">2</span> <span class="hljs-comment"># &#x6700;&#x591A;&#x80FD;&#x591F;&#x540C;&#x65F6;&#x542F;&#x52A8;&#x7684;EXECUTOR&#x7684;&#x5B9E;&#x4F8B;&#x4E2A;&#x6570;</span>

ENABLE_HIVE_SUPPORT = <span class="hljs-keyword">False</span>
</code></pre>
<ul>
<li>&#x521B;&#x5EFA;&#x76F8;&#x5173;&#x914D;&#x7F6E;&#x3001;&#x5305;&#xFF0C;&#x5EFA;&#x7ACB;&#x57FA;&#x7C7B;</li>
</ul>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> pyspark <span class="hljs-keyword">import</span> SparkConf
<span class="hljs-keyword">from</span> pyspark.sql <span class="hljs-keyword">import</span> SparkSession
<span class="hljs-keyword">import</span> os


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SparkSessionBase</span><span class="hljs-params">(object)</span>:</span>

    SPARK_APP_NAME = <span class="hljs-keyword">None</span>
    SPARK_URL = <span class="hljs-string">&quot;yarn&quot;</span>

    SPARK_EXECUTOR_MEMORY = <span class="hljs-string">&quot;2g&quot;</span>
    SPARK_EXECUTOR_CORES = <span class="hljs-number">2</span>
    SPARK_EXECUTOR_INSTANCES = <span class="hljs-number">2</span>

    ENABLE_HIVE_SUPPORT = <span class="hljs-keyword">False</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_create_spark_session</span><span class="hljs-params">(self)</span>:</span>

        conf = SparkConf()  <span class="hljs-comment"># &#x521B;&#x5EFA;spark config&#x5BF9;&#x8C61;</span>
        config = (
            (<span class="hljs-string">&quot;spark.app.name&quot;</span>, self.SPARK_APP_NAME),  <span class="hljs-comment"># &#x8BBE;&#x7F6E;&#x542F;&#x52A8;&#x7684;spark&#x7684;app&#x540D;&#x79F0;&#xFF0C;&#x6CA1;&#x6709;&#x63D0;&#x4F9B;&#xFF0C;&#x5C06;&#x968F;&#x673A;&#x4EA7;&#x751F;&#x4E00;&#x4E2A;&#x540D;&#x79F0;</span>
            (<span class="hljs-string">&quot;spark.executor.memory&quot;</span>, self.SPARK_EXECUTOR_MEMORY),  <span class="hljs-comment"># &#x8BBE;&#x7F6E;&#x8BE5;app&#x542F;&#x52A8;&#x65F6;&#x5360;&#x7528;&#x7684;&#x5185;&#x5B58;&#x7528;&#x91CF;&#xFF0C;&#x9ED8;&#x8BA4;2g</span>
            (<span class="hljs-string">&quot;spark.master&quot;</span>, self.SPARK_URL),  <span class="hljs-comment"># spark master&#x7684;&#x5730;&#x5740;</span>
            (<span class="hljs-string">&quot;spark.executor.cores&quot;</span>, self.SPARK_EXECUTOR_CORES),  <span class="hljs-comment"># &#x8BBE;&#x7F6E;spark executor&#x4F7F;&#x7528;&#x7684;CPU&#x6838;&#x5FC3;&#x6570;&#xFF0C;&#x9ED8;&#x8BA4;&#x662F;1&#x6838;&#x5FC3;</span>
            (<span class="hljs-string">&quot;spark.executor.instances&quot;</span>, self.SPARK_EXECUTOR_INSTANCES)
        )

        conf.setAll(config)

        <span class="hljs-comment"># &#x5229;&#x7528;config&#x5BF9;&#x8C61;&#xFF0C;&#x521B;&#x5EFA;spark session</span>
        <span class="hljs-keyword">if</span> self.ENABLE_HIVE_SUPPORT:
            <span class="hljs-keyword">return</span> SparkSession.builder.config(conf=conf).enableHiveSupport().getOrCreate()
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">return</span> SparkSession.builder.config(conf=conf).getOrCreate()
</code></pre>
<p>&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;&#x76EE;&#x5F55;&#xFF0C;&#x7528;&#x4E8E;&#x8FDB;&#x884C;&#x6587;&#x7AE0;&#x5185;&#x5BB9;&#x76F8;&#x5173;&#x8BA1;&#x7B97;&#x76EE;&#x5F55;&#xFF0C;&#x521B;&#x5EFA;reco_sys&#x63A8;&#x8350;&#x7CFB;&#x7EDF;&#x76F8;&#x5173;&#x8BA1;&#x7B97;&#x4E3B;&#x76EE;&#x5F55;&#xFF1A;&#x4E0B;&#x9762;&#x5EFA;&#x7ACB;&#x79BB;&#x7EBF;offline&#x4EE5;&#x53CA;full_cal</p>
<pre><code class="lang-python">[root@hadoop-master reco_sys]<span class="hljs-comment"># </span>
[root@hadoop-master reco_sys]<span class="hljs-comment"># tree</span>
.
&#x2514;&#x2500;&#x2500; offline
    &#x251C;&#x2500;&#x2500; full_cal
    &#x2514;&#x2500;&#x2500; __init__.py
</code></pre>
<h4 id="2412-&#x8FDB;&#x884C;&#x5408;&#x5E76;&#x8BA1;&#x7B97;">2.4.1.2 &#x8FDB;&#x884C;&#x5408;&#x5E76;&#x8BA1;&#x7B97;</h4>
<p>&#x7531;&#x4E8E;&#x6BCF;&#x6B21;&#x8C03;&#x8BD5;&#x8FD0;&#x884C;spark&#x65F6;&#x95F4;&#x8F83;&#x957F;&#xFF0C;&#x6211;&#x4EEC;&#x6700;&#x7EC8;&#x4EE3;&#x7801;&#x653E;&#x5728;pycharm&#x5F00;&#x53D1;&#x76EE;&#x5F55;&#x4E2D;&#xFF0C;&#x4F7F;&#x7528;jupyter notebook&#x8FDB;&#x884C;&#x5F00;&#x53D1;</p>
<p>&#x5728;&#x9879;&#x76EE;&#x76EE;&#x5F55;&#x5F00;&#x542F;</p>
<pre><code>jupyter notebook --allow-root --ip=192.168.19.137
</code></pre><ul>
<li>&#x6CE8;&#x610F;&#xFF1A;&#x672C;&#x5730;&#x5185;&#x5B58;&#x4E0D;&#x8DB3;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5C3D;&#x91CF;&#x4E0D;&#x8981;&#x540C;&#x65F6;&#x8FD0;&#x884C;&#x591A;&#x4E2A;Spark APP&#xFF0C;&#x5426;&#x5219;&#x6BD4;&#x5982;&#x67E5;&#x8BE2;HVIE&#x64CD;&#x4F5C;&#x4F1A;&#x5F88;&#x6162;&#xFF0C;&#x78C1;&#x76D8;&#x4E5F;&#x4FDD;&#x8BC1;&#x8DB3;&#x591F;</li>
</ul>
<p><img src="../images/&#x8FD0;&#x884C;&#x7684;APP.png" alt=""></p>
<ul>
<li>1&#x3001;&#x65B0;&#x5EFA;&#x6587;&#x7AE0;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x5B58;&#x50A8;&#x6587;&#x7AE0;&#x6570;&#x636E;&#x3001;&#x4E2D;&#x95F4;&#x8BA1;&#x7B97;&#x7ED3;&#x679C;&#x4EE5;&#x53CA;&#x6587;&#x7AE0;&#x753B;&#x50CF;&#x7ED3;&#x679C;</li>
</ul>
<pre><code class="lang-mysql">create database if not exists article comment &quot;artcile information&quot; location &apos;/user/hive/warehouse/article.db/&apos;;
</code></pre>
<ul>
<li>1&#x3001;&#x539F;&#x59CB;&#x6587;&#x7AE0;&#x6570;&#x636E;&#x5408;&#x5E76;&#x8868;&#x7ED3;&#x6784;,&#x5728;article&#x6570;&#x636E;&#x5E93;&#x4E2D;<ul>
<li>sentence:&#x6587;&#x7AE0;&#x6807;&#x9898;+&#x5185;&#x5BB9;+&#x9891;&#x9053;&#x540D;&#x5B57;&#x7684;&#x5408;&#x5E76;&#x7ED3;&#x679C;</li>
</ul>
</li>
</ul>
<pre><code class="lang-mysql">CREATE TABLE article_data(
article_id BIGINT comment &quot;article_id&quot;,
channel_id INT comment &quot;channel_id&quot;, 
channel_name STRING comment &quot;channel_name&quot;,
title STRING comment &quot;title&quot;,
content STRING comment &quot;content&quot;,
sentence STRING comment &quot;sentence&quot;)
COMMENT &quot;toutiao news_channel&quot;
LOCATION &apos;/user/hive/warehouse/article.db/article_data&apos;;
</code></pre>
<pre><code>hive&gt; select * from article_data limit 1;
OK
1       17      &#x524D;&#x7AEF;    Vue props&#x7528;&#x6CD5;&#x5C0F;&#x7ED3;&#x539F;&#x8350;   &lt;p&gt;&lt;strong&gt;Vue props&#x7528;&#x6CD5;&#x8BE6;&#x89E3;&lt;/strong&gt;&#x7EC4;&#x4EF6;&#x63A5;&#x53D7;&#x7684;&#x9009;&#x9879;&#x4E4B;&#x4E00; props &#x662F; Vue &#x4E2D;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x7684;&#x4E00;&#x4E2A;&#x9009;&#x9879;&#x3002;&#x7236;&#x5B50;&#x7EC4;&#x4EF6;&#x7684;&#x5173;&#x7CFB;&#x53EF;&#x4EE5;&#x603B;&#x7ED3;&#x4E3A;
</code></pre><ul>
<li>3&#x3001;&#x65B0;&#x5EFA;merge_data.ipynb&#x6587;&#x4EF6;<ul>
<li>&#x521D;&#x59CB;&#x5316;spark&#x4FE1;&#x606F;</li>
</ul>
</li>
</ul>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> sys
<span class="hljs-comment"># &#x5982;&#x679C;&#x5F53;&#x524D;&#x4EE3;&#x7801;&#x6587;&#x4EF6;&#x8FD0;&#x884C;&#x6D4B;&#x8BD5;&#x9700;&#x8981;&#x52A0;&#x5165;&#x4FEE;&#x6539;&#x8DEF;&#x5F84;&#xFF0C;&#x907F;&#x514D;&#x51FA;&#x73B0;&#x540E;&#x5BFC;&#x5305;&#x95EE;&#x9898;</span>
BASE_DIR = os.path.dirname(os.path.dirname(os.getcwd()))
sys.path.insert(<span class="hljs-number">0</span>, os.path.join(BASE_DIR))
PYSPARK_PYTHON = <span class="hljs-string">&quot;/miniconda2/envs/reco_sys/bin/python&quot;</span>
<span class="hljs-comment"># &#x5F53;&#x5B58;&#x5728;&#x591A;&#x4E2A;&#x7248;&#x672C;&#x65F6;&#xFF0C;&#x4E0D;&#x6307;&#x5B9A;&#x5F88;&#x53EF;&#x80FD;&#x4F1A;&#x5BFC;&#x81F4;&#x51FA;&#x9519;</span>
os.environ[<span class="hljs-string">&quot;PYSPARK_PYTHON&quot;</span>] = PYSPARK_PYTHON
os.environ[<span class="hljs-string">&quot;PYSPARK_DRIVER_PYTHON&quot;</span>] = PYSPARK_PYTHON
<span class="hljs-keyword">from</span> offline <span class="hljs-keyword">import</span> SparkSessionBase
</code></pre>
<p>&#x521B;&#x5EFA;&#x5408;&#x5E76;&#x6587;&#x7AE0;&#x7C7B;&#xFF0C;&#x96C6;&#x6210;sparksessionbase</p>
<pre><code class="lang-python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OriginArticleData</span><span class="hljs-params">(SparkSessionBase)</span>:</span>


    SPARK_APP_NAME = <span class="hljs-string">&quot;mergeArticle&quot;</span>
    SPARK_URL = <span class="hljs-string">&quot;yarn&quot;</span>

    ENABLE_HIVE_SUPPORT = <span class="hljs-keyword">True</span>

        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self)</span>:</span>
        self.spark = self._create_spark_session()
</code></pre>
<ul>
<li>&#x8BFB;&#x53D6;&#x6587;&#x7AE0;&#x8FDB;&#x884C;&#x5904;&#x7406;&#x5408;&#x5E76;</li>
</ul>
<pre><code class="lang-python">oa = OriginArticleData()
oa.spark.sql(<span class="hljs-string">&quot;use toutiao&quot;</span>)
<span class="hljs-comment"># &#x7531;&#x4E8E;&#x8FD0;&#x884C;&#x901F;&#x5EA6;&#x539F;&#x56E0;&#xFF0C;&#x9009;&#x62E9;&#x4E00;&#x7BC7;&#x6587;&#x7AE0;&#x90E8;&#x5206;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x6D4B;&#x8BD5;</span>
basic_content = oa.spark.sql(
            <span class="hljs-string">&quot;select a.article_id, a.channel_id, a.title, b.content from news_article_basic a inner join news_article_content b on a.article_id=b.article_id where a.article_id=116636&quot;</span>)
</code></pre>
<p>&#x5408;&#x5E76;&#x6570;&#x636E;</p>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> pyspark.sql.functions <span class="hljs-keyword">as</span> F
<span class="hljs-keyword">import</span> gc

<span class="hljs-comment"># &#x589E;&#x52A0;channel&#x7684;&#x540D;&#x5B57;&#xFF0C;&#x540E;&#x9762;&#x4F1A;&#x4F7F;&#x7528;</span>
basic_content.registerTempTable(<span class="hljs-string">&quot;temparticle&quot;</span>)
channel_basic_content = oa.spark.sql(
  <span class="hljs-string">&quot;select t.*, n.channel_name from temparticle t left join news_channel n on t.channel_id=n.channel_id&quot;</span>)

<span class="hljs-comment"># &#x5229;&#x7528;concat_ws&#x65B9;&#x6CD5;&#xFF0C;&#x5C06;&#x591A;&#x5217;&#x6570;&#x636E;&#x5408;&#x5E76;&#x4E3A;&#x4E00;&#x4E2A;&#x957F;&#x6587;&#x672C;&#x5185;&#x5BB9;&#xFF08;&#x9891;&#x9053;&#xFF0C;&#x6807;&#x9898;&#x4EE5;&#x53CA;&#x5185;&#x5BB9;&#x5408;&#x5E76;&#xFF09;</span>
oa.spark.sql(<span class="hljs-string">&quot;use article&quot;</span>)
sentence_df = channel_basic_content.select(<span class="hljs-string">&quot;article_id&quot;</span>, <span class="hljs-string">&quot;channel_id&quot;</span>, <span class="hljs-string">&quot;channel_name&quot;</span>, <span class="hljs-string">&quot;title&quot;</span>, <span class="hljs-string">&quot;content&quot;</span>, \
                                           F.concat_ws(
                                             <span class="hljs-string">&quot;,&quot;</span>,
                                             channel_basic_content.channel_name,
                                             channel_basic_content.title,
                                             channel_basic_content.content
                                           ).alias(<span class="hljs-string">&quot;sentence&quot;</span>)
                                          )
<span class="hljs-keyword">del</span> basic_content
<span class="hljs-keyword">del</span> channel_basic_content
gc.collect()

<span class="hljs-comment"># sentence_df.write.insertInto(&quot;article_data&quot;)</span>
</code></pre>
<p>&#x8FD0;&#x884C;&#x9700;&#x8981;&#x65F6;&#x95F4;&#x7B49;&#x5F85;&#x6210;&#x529F;&#xFF0C;&#x5982;&#x679C;&#x8FD8;&#x6709;&#x5176;&#x4ED6;&#x7A0B;&#x5E8F;&#x8FD0;&#x884C;&#xFF0C;&#x624B;&#x52A8;&#x91CA;&#x653E;&#x5185;&#x5B58;&#xFF0C;&#x907F;&#x514D;&#x4E0D;&#x591F;</p>
<pre><code class="lang-python"><span class="hljs-keyword">del</span> basic_content
<span class="hljs-keyword">del</span> channel_basic_content
gc.collect()
</code></pre>
<p>&#x7136;&#x540E;&#x6267;&#x884C;&#x67E5;&#x8BE2;&#xFF0C;&#x770B;&#x770B;&#x662F;&#x5426;&#x5199;&#x5165;&#x9009;&#x5B9A;&#x7684;&#x6587;&#x7AE0;</p>
<pre><code class="lang-python">hive&gt; select * <span class="hljs-keyword">from</span> article_data limit <span class="hljs-number">1</span>;
</code></pre>
<h4 id="&#x4E0A;&#x4F20;&#x5408;&#x5E76;&#x5B8C;&#x6210;&#x7684;&#x6240;&#x6709;&#x5386;&#x53F2;&#x6570;&#x636E;">&#x4E0A;&#x4F20;&#x5408;&#x5E76;&#x5B8C;&#x6210;&#x7684;&#x6240;&#x6709;&#x5386;&#x53F2;&#x6570;&#x636E;</h4>
<p><strong>&#x4EE5;&#x4E0A;&#x6D4B;&#x8BD5;&#x5728;&#x5C11;&#x91CF;&#x6570;&#x636E;&#x4E0A;&#x8FDB;&#x884C;&#x6D4B;&#x8BD5;&#x5199;&#x5165;&#x5408;&#x5E76;&#x6587;&#x7AE0;&#x6570;&#x636E;&#xFF0C;&#x6700;&#x7EC8;&#x6211;&#x4EEC;&#x62FF;&#x4E4B;&#x524D;&#x5408;&#x5E76;&#x7684;&#x6240;&#x6709;&#x6587;&#x7AE0;&#x6570;&#x636E;&#x76F4;&#x63A5;&#x4E0A;&#x4F20;&#x5230;hadoop&#x4E0A;&#x4F7F;&#x7528;</strong></p>
<pre><code class="lang-python">hadoop dfs -put /root/bak/hadoopbak/article.db/article_data/ /user/hive/warehouse/article.db/article_data/
</code></pre>
<h3 id="242-tfidf&#x8BA1;&#x7B97;">2.4.2 Tfidf&#x8BA1;&#x7B97;</h3>
<h4 id="2421-&#x76EE;&#x7684;">2.4.2.1 &#x76EE;&#x7684;</h4>
<ul>
<li>&#x8BA1;&#x7B97;&#x51FA;&#x6BCF;&#x7BC7;&#x6587;&#x7AE0;&#x7684;&#x8BCD;&#x8BED;&#x7684;TFIDF&#x7ED3;&#x679C;&#x7528;&#x4E8E;&#x62BD;&#x53D6;&#x753B;&#x50CF;</li>
</ul>
<h4 id="2422tfidf&#x6A21;&#x578B;&#x7684;&#x8BAD;&#x7EC3;&#x6B65;&#x9AA4;">2.4.2.2TFIDF&#x6A21;&#x578B;&#x7684;&#x8BAD;&#x7EC3;&#x6B65;&#x9AA4;</h4>
<ul>
<li>&#x8BFB;&#x53D6;N&#x7BC7;&#x6587;&#x7AE0;&#x6570;&#x636E;</li>
<li>&#x6587;&#x7AE0;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x5206;&#x8BCD;&#x5904;&#x7406;,&#x5F97;&#x5230;&#x5206;&#x8BCD;&#x7ED3;&#x679C;</li>
<li>TFIDF&#x6A21;&#x578B;&#x8BAD;&#x7EC3;&#x4FDD;&#x5B58;&#xFF0C;spark&#x4F7F;&#x7528;count&#x4E0E;idf&#x8FDB;&#x884C;&#x8BA1;&#x7B97;<ul>
<li>TFIDF&#x8BA1;&#x7B97;&#x65B9;&#x6848;&#xFF1A;</li>
<li><strong>&#x5148;&#x8BA1;&#x7B97;&#x5206;&#x8BCD;&#x4E4B;&#x540E;&#x7684;&#x6BCF;&#x7BC7;&#x6587;&#x7AE0;&#x7684;&#x8BCD;&#x9891;&#xFF0C;&#x5F97;&#x5230;CV&#x6A21;&#x578B;</strong></li>
<li><strong>&#x7136;&#x540E;&#x6839;&#x636E;&#x8BCD;&#x9891;&#x8BA1;&#x7B97;IDF&#x4EE5;&#x53CA;&#x8BCD;&#xFF0C;&#x5F97;&#x5230;IDF&#x6A21;&#x578B;</strong></li>
</ul>
</li>
<li>&#x5229;&#x7528;&#x6A21;&#x578B;&#x8BA1;&#x7B97;N&#x7BC7;&#x6587;&#x7AE0;&#x6570;&#x636E;&#x7684;TFIDF&#x503C;</li>
</ul>
<h4 id="2423-&#x5B9E;&#x73B0;">2.4.2.3 &#x5B9E;&#x73B0;</h4>
<p>&#x60F3;&#x8981;&#x7528;TFIDF&#x8FDB;&#x884C;&#x8BA1;&#x7B97;&#xFF0C;&#x9700;&#x8981;&#x8BAD;&#x7EC3;&#x4E00;&#x4E2A;&#x6A21;&#x578B;&#x4FDD;&#x5B58;&#x7ED3;&#x679C;</p>
<ul>
<li>&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;compute_tfidf.ipynb&#x7684;&#x6587;&#x4EF6;</li>
</ul>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> sys
<span class="hljs-comment"># &#x5982;&#x679C;&#x5F53;&#x524D;&#x4EE3;&#x7801;&#x6587;&#x4EF6;&#x8FD0;&#x884C;&#x6D4B;&#x8BD5;&#x9700;&#x8981;&#x52A0;&#x5165;&#x4FEE;&#x6539;&#x8DEF;&#x5F84;&#xFF0C;&#x907F;&#x514D;&#x51FA;&#x73B0;&#x540E;&#x5BFC;&#x5305;&#x95EE;&#x9898;</span>
BASE_DIR = os.path.dirname(os.path.dirname(os.getcwd()))
sys.path.insert(<span class="hljs-number">0</span>, os.path.join(BASE_DIR))
PYSPARK_PYTHON = <span class="hljs-string">&quot;/miniconda2/envs/reco_sys/bin/python&quot;</span>
<span class="hljs-comment"># &#x5F53;&#x5B58;&#x5728;&#x591A;&#x4E2A;&#x7248;&#x672C;&#x65F6;&#xFF0C;&#x4E0D;&#x6307;&#x5B9A;&#x5F88;&#x53EF;&#x80FD;&#x4F1A;&#x5BFC;&#x81F4;&#x51FA;&#x9519;</span>
os.environ[<span class="hljs-string">&quot;PYSPARK_PYTHON&quot;</span>] = PYSPARK_PYTHON
os.environ[<span class="hljs-string">&quot;PYSPARK_DRIVER_PYTHON&quot;</span>] = PYSPARK_PYTHON
<span class="hljs-keyword">from</span> offline <span class="hljs-keyword">import</span> SparkSessionBase

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">KeywordsToTfidf</span><span class="hljs-params">(SparkSessionBase)</span>:</span>

    SPARK_APP_NAME = <span class="hljs-string">&quot;keywordsByTFIDF&quot;</span>
    SPARK_EXECUTOR_MEMORY = <span class="hljs-string">&quot;7g&quot;</span>

    ENABLE_HIVE_SUPPORT = <span class="hljs-keyword">True</span>

        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self)</span>:</span>
        self.spark = self._create_spark_session()
</code></pre>
<pre><code class="lang-python">ktt = KeywordsToTfidf()
</code></pre>
<ul>
<li>&#x8BFB;&#x53D6;&#x6587;&#x7AE0;&#x539F;&#x59CB;&#x6570;&#x636E;</li>
</ul>
<pre><code class="lang-python">ktt.spark.sql(<span class="hljs-string">&quot;use article&quot;</span>)
article_dataframe = ktt.spark.sql(<span class="hljs-string">&quot;select * from article_data limit 20&quot;</span>)
words_df = article_dataframe.rdd.mapPartitions(segmentation).toDF([<span class="hljs-string">&quot;article_id&quot;</span>, <span class="hljs-string">&quot;channel_id&quot;</span>, <span class="hljs-string">&quot;words&quot;</span>])
</code></pre>
<ul>
<li>&#x6587;&#x7AE0;&#x6570;&#x636E;&#x5904;&#x7406;&#x51FD;&#x6570;<ul>
<li>&#x5982;&#x679C;&#x5206;&#x5E03;&#x5F0F;&#x73AF;&#x5883;&#x2014;&gt;&#x7ED3;&#x5DF4;&#x8BCD;&#x5178;&#xFF0C;&#x4EE5;&#x53CA;&#x505C;&#x7528;&#x8BCD;(&#x8BCD;&#x5178;&#x6587;&#x4EF6;&#xFF0C;&#x4E09;&#x53F0;Centos&#x90FD;&#x9700;&#x8981;&#x4E0A;&#x4F20;&#x4E00;&#x4EFD;&#xFF0C;&#x76EE;&#x5F55;&#x76F8;&#x540C;)</li>
<li>ITKeywords.txt, stopwords.txt</li>
</ul>
</li>
</ul>
<pre><code>scp -r ./words/ root@192.168.19.138:/root/words/
scp -r ./words/ root@192.168.19.139:/root/words/
</code></pre><p>&#x5206;&#x8BCD;&#x90E8;&#x5206;&#x4EE3;&#x7801;&#xFF1A;</p>
<pre><code class="lang-python"><span class="hljs-comment"># &#x5206;&#x8BCD;</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">segmentation</span><span class="hljs-params">(partition)</span>:</span>
    <span class="hljs-keyword">import</span> os
    <span class="hljs-keyword">import</span> re

    <span class="hljs-keyword">import</span> jieba
    <span class="hljs-keyword">import</span> jieba.analyse
    <span class="hljs-keyword">import</span> jieba.posseg <span class="hljs-keyword">as</span> pseg
    <span class="hljs-keyword">import</span> codecs

    abspath = <span class="hljs-string">&quot;/root/words&quot;</span>

    <span class="hljs-comment"># &#x7ED3;&#x5DF4;&#x52A0;&#x8F7D;&#x7528;&#x6237;&#x8BCD;&#x5178;</span>
    userDict_path = os.path.join(abspath, <span class="hljs-string">&quot;ITKeywords.txt&quot;</span>)
    jieba.load_userdict(userDict_path)

    <span class="hljs-comment"># &#x505C;&#x7528;&#x8BCD;&#x6587;&#x672C;</span>
    stopwords_path = os.path.join(abspath, <span class="hljs-string">&quot;stopwords.txt&quot;</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_stopwords_list</span><span class="hljs-params">()</span>:</span>
        <span class="hljs-string">&quot;&quot;&quot;&#x8FD4;&#x56DE;stopwords&#x5217;&#x8868;&quot;&quot;&quot;</span>
        stopwords_list = [i.strip()
                          <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> codecs.open(stopwords_path).readlines()]
        <span class="hljs-keyword">return</span> stopwords_list

    <span class="hljs-comment"># &#x6240;&#x6709;&#x7684;&#x505C;&#x7528;&#x8BCD;&#x5217;&#x8868;</span>
    stopwords_list = get_stopwords_list()

    <span class="hljs-comment"># &#x5206;&#x8BCD;</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">cut_sentence</span><span class="hljs-params">(sentence)</span>:</span>
        <span class="hljs-string">&quot;&quot;&quot;&#x5BF9;&#x5207;&#x5272;&#x4E4B;&#x540E;&#x7684;&#x8BCD;&#x8BED;&#x8FDB;&#x884C;&#x8FC7;&#x6EE4;&#xFF0C;&#x53BB;&#x9664;&#x505C;&#x7528;&#x8BCD;&#xFF0C;&#x4FDD;&#x7559;&#x540D;&#x8BCD;&#xFF0C;&#x82F1;&#x6587;&#x548C;&#x81EA;&#x5B9A;&#x4E49;&#x8BCD;&#x5E93;&#x4E2D;&#x7684;&#x8BCD;&#xFF0C;&#x957F;&#x5EA6;&#x5927;&#x4E8E;2&#x7684;&#x8BCD;&quot;&quot;&quot;</span>
        <span class="hljs-comment"># print(sentence,&quot;*&quot;*100)</span>
        <span class="hljs-comment"># eg:[pair(&apos;&#x4ECA;&#x5929;&apos;, &apos;t&apos;), pair(&apos;&#x6709;&apos;, &apos;d&apos;), pair(&apos;&#x96FE;&apos;, &apos;n&apos;), pair(&apos;&#x973E;&apos;, &apos;g&apos;)]</span>
        seg_list = pseg.lcut(sentence)
        seg_list = [i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> seg_list <span class="hljs-keyword">if</span> i.flag <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> stopwords_list]
        filtered_words_list = []
        <span class="hljs-keyword">for</span> seg <span class="hljs-keyword">in</span> seg_list:
            <span class="hljs-comment"># print(seg)</span>
            <span class="hljs-keyword">if</span> len(seg.word) &lt;= <span class="hljs-number">1</span>:
                <span class="hljs-keyword">continue</span>
            <span class="hljs-keyword">elif</span> seg.flag == <span class="hljs-string">&quot;eng&quot;</span>:
                <span class="hljs-keyword">if</span> len(seg.word) &lt;= <span class="hljs-number">2</span>:
                    <span class="hljs-keyword">continue</span>
                <span class="hljs-keyword">else</span>:
                    filtered_words_list.append(seg.word)
            <span class="hljs-keyword">elif</span> seg.flag.startswith(<span class="hljs-string">&quot;n&quot;</span>):
                filtered_words_list.append(seg.word)
            <span class="hljs-keyword">elif</span> seg.flag <span class="hljs-keyword">in</span> [<span class="hljs-string">&quot;x&quot;</span>, <span class="hljs-string">&quot;eng&quot;</span>]:  <span class="hljs-comment"># &#x662F;&#x81EA;&#x5B9A;&#x4E00;&#x4E2A;&#x8BCD;&#x8BED;&#x6216;&#x8005;&#x662F;&#x82F1;&#x6587;&#x5355;&#x8BCD;</span>
                filtered_words_list.append(seg.word)
        <span class="hljs-keyword">return</span> filtered_words_list

    <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> partition:
        sentence = re.sub(<span class="hljs-string">&quot;&lt;.*?&gt;&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, row.sentence)    <span class="hljs-comment"># &#x66FF;&#x6362;&#x6389;&#x6807;&#x7B7E;&#x6570;&#x636E;</span>
        words = cut_sentence(sentence)
        <span class="hljs-keyword">yield</span> row.article_id, row.channel_id, words
</code></pre>
<ul>
<li>&#x8BAD;&#x7EC3;&#x6A21;&#x578B;,&#x5F97;&#x5230;&#x6BCF;&#x4E2A;&#x6587;&#x7AE0;&#x8BCD;&#x7684;&#x9891;&#x7387;Counts&#x7ED3;&#x679C;</li>
</ul>
<pre><code class="lang-python"><span class="hljs-comment"># &#x8BCD;&#x8BED;&#x4E0E;&#x8BCD;&#x9891;&#x7EDF;&#x8BA1;</span>
<span class="hljs-keyword">from</span> pyspark.ml.feature <span class="hljs-keyword">import</span> CountVectorizer
<span class="hljs-comment"># &#x603B;&#x8BCD;&#x6C47;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x6587;&#x672C;&#x4E2D;&#x5FC5;&#x987B;&#x51FA;&#x73B0;&#x7684;&#x6B21;&#x6570;</span>
cv = CountVectorizer(inputCol=<span class="hljs-string">&quot;words&quot;</span>, outputCol=<span class="hljs-string">&quot;countFeatures&quot;</span>, vocabSize=<span class="hljs-number">200</span>*<span class="hljs-number">10000</span>, minDF=<span class="hljs-number">1.0</span>)
<span class="hljs-comment"># &#x8BAD;&#x7EC3;&#x8BCD;&#x9891;&#x7EDF;&#x8BA1;&#x6A21;&#x578B;</span>
cv_model = cv.fit(words_df)
cv_model.write().overwrite().save(<span class="hljs-string">&quot;hdfs://hadoop-master:9000/headlines/models/CV.model&quot;</span>)
</code></pre>
<p><img src="../images/count&#x7ED3;&#x679C;.png" alt=""></p>
<ul>
<li>&#x8BAD;&#x7EC3;idf&#x6A21;&#x578B;&#xFF0C;&#x4FDD;&#x5B58;</li>
</ul>
<pre><code class="lang-python"><span class="hljs-comment"># &#x8BCD;&#x8BED;&#x4E0E;&#x8BCD;&#x9891;&#x7EDF;&#x8BA1;</span>
<span class="hljs-keyword">from</span> pyspark.ml.feature <span class="hljs-keyword">import</span> CountVectorizerModel
cv_model = CountVectorizerModel.load(<span class="hljs-string">&quot;hdfs://hadoop-master:9000/headlines/models/CV.model&quot;</span>)
<span class="hljs-comment"># &#x5F97;&#x51FA;&#x8BCD;&#x9891;&#x5411;&#x91CF;&#x7ED3;&#x679C;</span>
cv_result = cv_model.transform(words_df)
<span class="hljs-comment"># &#x8BAD;&#x7EC3;IDF&#x6A21;&#x578B;</span>
<span class="hljs-keyword">from</span> pyspark.ml.feature <span class="hljs-keyword">import</span> IDF
idf = IDF(inputCol=<span class="hljs-string">&quot;countFeatures&quot;</span>, outputCol=<span class="hljs-string">&quot;idfFeatures&quot;</span>)
idfModel = idf.fit(cv_result)
idfModel.write().overwrite().save(<span class="hljs-string">&quot;hdfs://hadoop-master:9000/headlines/models/IDF.model&quot;</span>)
</code></pre>
<p>&#x5F97;&#x5230;&#x4E86;&#x4E24;&#x4E2A;&#x5C11;&#x91CF;&#x6587;&#x7AE0;&#x6D4B;&#x8BD5;&#x7684;&#x6A21;&#x578B;&#xFF0C;&#x4EE5;&#x8FD9;&#x4E24;&#x4E2A;&#x6A21;&#x578B;&#x4E3A;&#x4F8B;&#x5B50;&#x67E5;&#x770B;&#x7ED3;&#x679C;&#xFF0C;&#x6240;&#x6709;&#x4E0D;&#x540C;&#x7684;&#x8BCD;</p>
<pre><code class="lang-python">cv_model.vocabulary
[<span class="hljs-string">&apos;this&apos;</span>,
 <span class="hljs-string">&apos;pa&apos;</span>,
 <span class="hljs-string">&apos;node&apos;</span>,
 <span class="hljs-string">&apos;data&apos;</span>,
 <span class="hljs-string">&apos;&#x6570;&#x636E;&apos;</span>,
 <span class="hljs-string">&apos;let&apos;</span>,
 <span class="hljs-string">&apos;keys&apos;</span>,
 <span class="hljs-string">&apos;obj&apos;</span>,
 <span class="hljs-string">&apos;&#x7EC4;&#x4EF6;&apos;</span>,
 <span class="hljs-string">&apos;npm&apos;</span>,
 <span class="hljs-string">&apos;child&apos;</span>,
 <span class="hljs-string">&apos;&#x8282;&#x70B9;&apos;</span>,
 <span class="hljs-string">&apos;log&apos;</span>,
 <span class="hljs-string">&apos;&#x5C5E;&#x6027;&apos;</span>,
 <span class="hljs-string">&apos;key&apos;</span>,
 <span class="hljs-string">&apos;console&apos;</span>,
 <span class="hljs-string">&apos;value&apos;</span>,
 <span class="hljs-string">&apos;var&apos;</span>,
 <span class="hljs-string">&apos;return&apos;</span>,
 <span class="hljs-string">&apos;div&apos;</span>]

<span class="hljs-comment"># &#x6BCF;&#x4E2A;&#x8BCD;&#x7684;&#x9006;&#x6587;&#x6863;&#x9891;&#x7387;&#xFF0C;&#x5728;&#x5386;&#x53F2;13&#x4E07;&#x6587;&#x7AE0;&#x5F53;&#x4E2D;&#x662F;&#x56FA;&#x5B9A;&#x7684;&#x503C;&#xFF0C;&#x4E5F;&#x4F5C;&#x4E3A;&#x540E;&#x9762;&#x8BA1;&#x7B97;TFIDF&#x4F9D;&#x636E;</span>
idfModel.idf.toArray()[:<span class="hljs-number">20</span>]
array([<span class="hljs-number">0.6061358</span> , <span class="hljs-number">0.</span>        , <span class="hljs-number">0.6061358</span> , <span class="hljs-number">0.6061358</span> , <span class="hljs-number">0.45198512</span>,
       <span class="hljs-number">0.78845736</span>, <span class="hljs-number">1.01160091</span>, <span class="hljs-number">1.01160091</span>, <span class="hljs-number">1.01160091</span>, <span class="hljs-number">0.78845736</span>,
       <span class="hljs-number">1.29928298</span>, <span class="hljs-number">1.70474809</span>, <span class="hljs-number">0.31845373</span>, <span class="hljs-number">1.01160091</span>, <span class="hljs-number">0.78845736</span>,
       <span class="hljs-number">0.45198512</span>, <span class="hljs-number">0.78845736</span>, <span class="hljs-number">0.78845736</span>, <span class="hljs-number">0.45198512</span>, <span class="hljs-number">1.70474809</span>])
</code></pre>
<h4 id="&#x4E0A;&#x4F20;&#x8BAD;&#x7EC3;13&#x4E07;&#x6587;&#x7AE0;&#x7684;&#x6A21;&#x578B;">&#x4E0A;&#x4F20;&#x8BAD;&#x7EC3;13&#x4E07;&#x6587;&#x7AE0;&#x7684;&#x6A21;&#x578B;</h4>
<ul>
<li>20&#x7BC7;&#x6587;&#x7AE0;&#xFF0C;&#x8BA1;&#x7B97;&#x51FA;&#x4EE3;&#x8868;20&#x7BC7;&#x6587;&#x7AE0;&#x4E2D;N&#x4E2A;&#x8BCD;&#x7684;IDF&#x4EE5;&#x53CA;&#x6BCF;&#x4E2A;&#x6587;&#x6863;&#x7684;&#x8BCD;&#x9891;&#xFF0C;&#x6700;&#x7EC8;&#x5F97;&#x5230;&#x7684;&#x662F;&#x8FD9;20&#x7247;&#x6587;&#x7AE0;&#x7684;TFIDF</li>
</ul>
<p>&#x4E24;&#x4E2A;&#x6A21;&#x578B;&#x8BAD;&#x7EC3;&#x9700;&#x8981;&#x5F88;&#x4E45;&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x4E0A;&#x4F20;&#x5DF2;&#x7ECF;&#x8BAD;&#x7EC3;&#x597D;&#x7684;&#x6A21;&#x578B;&#x5230;&#x6307;&#x5B9A;&#x8DEF;&#x5F84;</p>
<pre><code class="lang-shell">hadoop dfs -mkdir /headlines

hadoop dfs -mkdir /headlines/models/

hadoop dfs -put modelsbak/countVectorizerOfArticleWords.model/ /headlines/models/
hadoop dfs -put modelsbak/IDFOfArticleWords.model/ /headlines/models/
</code></pre>
<p>&#x6700;&#x7EC8;&#xFF1A;</p>
<p><img src="../images/&#x6A21;&#x578B;&#x5B58;&#x653E;&#x76EE;&#x5F55;.png" alt=""></p>
<h4 id="2423-&#x8BA1;&#x7B97;n&#x7BC7;&#x6587;&#x7AE0;&#x6570;&#x636E;&#x7684;tfidf&#x503C;">2.4.2.3 &#x8BA1;&#x7B97;N&#x7BC7;&#x6587;&#x7AE0;&#x6570;&#x636E;&#x7684;TFIDF&#x503C;</h4>
<ul>
<li>&#x6B65;&#x9AA4;&#xFF1A;<ul>
<li>1&#x3001;<strong>&#x83B7;&#x53D6;&#x4E24;&#x4E2A;&#x6A21;&#x578B;&#x76F8;&#x5173;&#x53C2;&#x6570;&#xFF0C;&#x5C06;&#x6240;&#x6709;&#x7684;13&#x4E07;&#x6587;&#x7AE0;&#x4E2D;&#x7684;&#x5173;&#x952E;&#x5B57;&#x5BF9;&#x5E94;&#x7684;idf&#x503C;&#x548C;&#x7D22;&#x5F15;&#x4FDD;&#x5B58;</strong><ul>
<li>&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x4FDD;&#x5B58;&#x8FD9;&#x4E9B;&#x503C;&#xFF1F;&#x5E76;&#x4E14;&#x5B58;&#x5165;&#x6570;&#x636E;&#x5E93;&#x5F53;&#x4E2D;&#xFF1F;</li>
</ul>
</li>
<li>2&#x3001;&#x6A21;&#x578B;&#x8BA1;&#x7B97;&#x5F97;&#x51FA;N&#x7BC7;&#x6587;&#x7AE0;&#x7684;TFIDF&#x503C;&#x9009;&#x53D6;TOPK&#xFF0C;&#x4E0E;IDF&#x7D22;&#x5F15;&#x67E5;&#x8BE2;&#x5F97;&#x5230;&#x8BCD;</li>
</ul>
</li>
</ul>
<h5 id="&#x83B7;&#x53D6;&#x4E24;&#x4E2A;&#x6A21;&#x578B;&#x76F8;&#x5173;&#x53C2;&#x6570;&#xFF0C;&#x5C06;&#x6240;&#x6709;&#x7684;&#x5173;&#x952E;&#x5B57;&#x5BF9;&#x5E94;&#x7684;idf&#x503C;&#x548C;&#x7D22;&#x5F15;&#x4FDD;&#x5B58;">&#x83B7;&#x53D6;&#x4E24;&#x4E2A;&#x6A21;&#x578B;&#x76F8;&#x5173;&#x53C2;&#x6570;&#xFF0C;&#x5C06;&#x6240;&#x6709;&#x7684;&#x5173;&#x952E;&#x5B57;&#x5BF9;&#x5E94;&#x7684;idf&#x503C;&#x548C;&#x7D22;&#x5F15;&#x4FDD;&#x5B58;</h5>
<ul>
<li><p>&#x540E;&#x7EED;&#x8BA1;&#x7B97;tfidf&#x753B;&#x50CF;&#x9700;&#x8981;&#x4F7F;&#x7528;&#xFF0C;&#x907F;&#x514D;&#x653E;&#x5165;&#x5185;&#x5B58;&#x4E2D;&#x5360;&#x7528;&#x8FC7;&#x591A;&#xFF0C;&#x6301;&#x4E45;&#x5316;&#x4F7F;&#x7528;</p>
</li>
<li><p>&#x5EFA;&#x7ACB;&#x8868;</p>
</li>
</ul>
<pre><code class="lang-mysql">CREATE TABLE idf_keywords_values(
keyword STRING comment &quot;article_id&quot;,
idf DOUBLE comment &quot;idf&quot;,
index INT comment &quot;index&quot;);
</code></pre>
<p>&#x7136;&#x540E;&#x8BFB;&#x53D6;13&#x4E07;&#x53C2;&#x8003;&#x6587;&#x6863;&#x6240;&#x6709;&#x8BCD;&#x8BED;&#x4E0E;IDF&#x503C;&#x8FDB;&#x884C;&#x8BA1;&#x7B97;&#xFF1A;</p>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> pyspark.ml.feature <span class="hljs-keyword">import</span> CountVectorizerModel
cv_model = CountVectorizerModel.load(<span class="hljs-string">&quot;hdfs://hadoop-master:9000/headlines/models/countVectorizerOfArticleWords.model&quot;</span>)

<span class="hljs-keyword">from</span> pyspark.ml.feature <span class="hljs-keyword">import</span> IDFModel
idf_model = IDFModel.load(<span class="hljs-string">&quot;hdfs://hadoop-master:9000/headlines/models/IDFOfArticleWords.model&quot;</span>)
</code></pre>
<p>&#x8FDB;&#x884C;&#x8BA1;&#x7B97;&#x4FDD;&#x5B58;</p>
<pre><code class="lang-python"><span class="hljs-comment">#keywords_list_with_idf = list(zip(cv_model.vocabulary, idf_model.idf.toArray()))</span>
<span class="hljs-comment">#def func(data):</span>
<span class="hljs-comment">#    for index in range(len(data)):</span>
<span class="hljs-comment">#    data[index] = list(data[index])</span>
<span class="hljs-comment">#    data[index].append(index)</span>
<span class="hljs-comment">#    data[index][1] = float(data[index][1])</span>
<span class="hljs-comment">#func(keywords_list_with_idf)</span>
<span class="hljs-comment">#sc = spark.sparkContext</span>
<span class="hljs-comment">#rdd = sc.parallelize(keywords_list_with_idf)</span>
<span class="hljs-comment">#df = rdd.toDF([&quot;keywords&quot;, &quot;idf&quot;, &quot;index&quot;])</span>

<span class="hljs-comment"># df.write.insertInto(&apos;idf_keywords_values&apos;)</span>
</code></pre>
<p>&#x5B58;&#x50A8;&#x7ED3;&#x679C;&#xFF1A;</p>
<pre><code class="lang-python">hive&gt; select * <span class="hljs-keyword">from</span> idf_keywords_values limit <span class="hljs-number">10</span>;
OK
&amp;<span class="hljs-comment">#      1.417829594344155       0</span>
pa      <span class="hljs-number">0.6651385256756351</span>      <span class="hljs-number">1</span>
ul      <span class="hljs-number">0.8070591229443697</span>      <span class="hljs-number">2</span>
&#x4EE3;&#x7801;    <span class="hljs-number">0.7368239176481552</span>      <span class="hljs-number">3</span>
&#x65B9;&#x6CD5;    <span class="hljs-number">0.7506253985501485</span>      <span class="hljs-number">4</span>
&#x6570;&#x636E;    <span class="hljs-number">0.9375297590538404</span>      <span class="hljs-number">5</span>
<span class="hljs-keyword">return</span>  <span class="hljs-number">1.1584986818528347</span>      <span class="hljs-number">6</span>
&#x5BF9;&#x8C61;    <span class="hljs-number">1.2765716628665975</span>      <span class="hljs-number">7</span>
name    <span class="hljs-number">1.3833429138490618</span>      <span class="hljs-number">8</span>
this    <span class="hljs-number">1.6247297855214076</span>      <span class="hljs-number">9</span>

hive&gt; desc idf_keywords_values;
OK
keyword                 string                  article_id          
idf                     double                  idf                 
index                   int                     index
</code></pre>
<h4 id="&#x6A21;&#x578B;&#x8BA1;&#x7B97;&#x5F97;&#x51FA;n&#x7BC7;&#x6587;&#x7AE0;&#x7684;tfidf&#x503C;&#xFF0C;idf&#x7D22;&#x5F15;&#x7ED3;&#x679C;&#x5408;&#x5E76;&#x5F97;&#x5230;&#x8BCD;">&#x6A21;&#x578B;&#x8BA1;&#x7B97;&#x5F97;&#x51FA;N&#x7BC7;&#x6587;&#x7AE0;&#x7684;TFIDF&#x503C;&#xFF0C;IDF&#x7D22;&#x5F15;&#x7ED3;&#x679C;&#x5408;&#x5E76;&#x5F97;&#x5230;&#x8BCD;</h4>
<p>&#x5BF9;&#x4E8E;&#x8BCD;&#x9891;&#x5904;&#x7406;&#x4E4B;&#x540E;&#x7684;&#x7ED3;&#x679C;&#x8FDB;&#x884C;&#x8BA1;&#x7B97;</p>
<p>&#x4FDD;&#x5B58;TFIDF&#x7684;&#x7ED3;&#x679C;,&#x5728;article&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x521B;&#x5EFA;&#x8868;</p>
<pre><code class="lang-mysql">CREATE TABLE tfidf_keywords_values(
article_id INT comment &quot;article_id&quot;,
channel_id INT comment &quot;channel_id&quot;,
keyword STRING comment &quot;keyword&quot;,
tfidf DOUBLE comment &quot;tfidf&quot;);
</code></pre>
<p>&#x8BA1;&#x7B97;tfidf&#x503C;&#x8FDB;&#x884C;&#x5B58;&#x50A8;</p>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> pyspark.ml.feature <span class="hljs-keyword">import</span> CountVectorizerModel
cv_model = CountVectorizerModel.load(<span class="hljs-string">&quot;hdfs://hadoop-master:9000/headlines/models/countVectorizerOfArticleWords.model&quot;</span>)
<span class="hljs-keyword">from</span> pyspark.ml.feature <span class="hljs-keyword">import</span> IDFModel
idf_model = IDFModel.load(<span class="hljs-string">&quot;hdfs://hadoop-master:9000/headlines/models/IDFOfArticleWords.model&quot;</span>)
cv_result = cv_model.transform(words_df)
tfidf_result = idf_model.transform(cv_result)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">func</span><span class="hljs-params">(partition)</span>:</span>
    TOPK = <span class="hljs-number">20</span>
    <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> partition:
        <span class="hljs-comment"># &#x627E;&#x5230;&#x7D22;&#x5F15;&#x4E0E;IDF&#x503C;&#x5E76;&#x8FDB;&#x884C;&#x6392;&#x5E8F;</span>
        _ = list(zip(row.idfFeatures.indices, row.idfFeatures.values))
        _ = sorted(_, key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">1</span>], reverse=<span class="hljs-keyword">True</span>)
        result = _[:TOPK]
        <span class="hljs-keyword">for</span> word_index, tfidf <span class="hljs-keyword">in</span> result:
            <span class="hljs-keyword">yield</span> row.article_id, row.channel_id, int(word_index), round(float(tfidf), <span class="hljs-number">4</span>)

_keywordsByTFIDF = tfidf_result.rdd.mapPartitions(func).toDF([<span class="hljs-string">&quot;article_id&quot;</span>, <span class="hljs-string">&quot;channel_id&quot;</span>, <span class="hljs-string">&quot;index&quot;</span>, <span class="hljs-string">&quot;tfidf&quot;</span>])
</code></pre>
<p>&#x7ED3;&#x679C;&#x4E3A;&#xFF1A;</p>
<p><img src="../images/tfidf&#x7ED3;&#x679C;.png" alt=""></p>
<p><strong>&#x5982;&#x679C;&#x8981;&#x4FDD;&#x5B58;&#x5BF9;&#x5E94;words&#x8BFB;&#x53D6;idf_keywords_values&#x8868;&#x7ED3;&#x679C;&#x5408;&#x5E76;</strong></p>
<pre><code class="lang-python"><span class="hljs-comment"># &#x5229;&#x7528;&#x7ED3;&#x679C;&#x7D22;&#x5F15;&#x4E0E;&#x201D;idf_keywords_values&#x201C;&#x5408;&#x5E76;&#x77E5;&#x9053;&#x8BCD; </span>
keywordsIndex = ktt.spark.sql(<span class="hljs-string">&quot;select keyword, index idx from idf_keywords_values&quot;</span>)
<span class="hljs-comment"># &#x5229;&#x7528;&#x7ED3;&#x679C;&#x7D22;&#x5F15;&#x4E0E;&#x201D;idf_keywords_values&#x201C;&#x5408;&#x5E76;&#x77E5;&#x9053;&#x8BCD;</span>
keywordsByTFIDF = _keywordsByTFIDF.join(keywordsIndex, keywordsIndex.idx == _keywordsByTFIDF.index).select([<span class="hljs-string">&quot;article_id&quot;</span>, <span class="hljs-string">&quot;channel_id&quot;</span>, <span class="hljs-string">&quot;keyword&quot;</span>, <span class="hljs-string">&quot;tfidf&quot;</span>])
<span class="hljs-comment"># keywordsByTFIDF.write.insertInto(&quot;tfidf_keywords_values&quot;)</span>
</code></pre>
<p><img src="../images/TFIDF&#x7ED3;&#x679C;2.png" alt=""></p>
<p>&#x5408;&#x5E76;&#x4E4B;&#x540E;&#x5B58;&#x50A8;&#x5230;TFIDF&#x7ED3;&#x679C;&#x8868;&#x4E2D;&#xFF0C;&#x4FBF;&#x4E8E;&#x540E;&#x7EED;&#x8BFB;&#x53D6;&#x5904;&#x7406;</p>
<pre><code class="lang-mysql">hive&gt; desc tfidf_keywords_values;
OK
article_id              int                     article_id          
channel_id              int                     channel_id          
keyword                 string                  keyword             
tfidf                   double                  tfidf               
Time taken: 0.085 seconds, Fetched: 4 row(s)
hive&gt; select * from tfidf_keywords_values limit 10;
OK
98319   17      var     20.6079
98323   17      var     7.4938
98326   17      var     104.9128
98344   17      var     5.6203
98359   17      var     69.3174
98360   17      var     9.3672
98392   17      var     14.9875
98393   17      var     155.4958
98406   17      var     11.2407
98419   17      var     59.9502
Time taken: 0.499 seconds, Fetched: 10 row(s)
</code></pre>
<h3 id="243-textrank&#x63D0;&#x53D6;&#x5173;&#x952E;&#x8BCD;">2.4.3 TextRank&#x63D0;&#x53D6;&#x5173;&#x952E;&#x8BCD;</h3>
<p>TextRank&#x7531;Mihalcea&#x4E0E;Tarau&#x4E8E;EMNLP&#x5728;2014&#x5E74;&#x63D0;&#x51FA;&#x6765;&#xFF0C;&#x5176;&#x601D;&#x60F3;&#x975E;&#x5E38;&#x7B80;&#x5355;&#x3002;&#x5173;&#x952E;&#x8BCD;&#x62BD;&#x53D6;&#x7684;&#x4EFB;&#x52A1;&#x5C31;&#x662F;&#x4ECE;&#x4E00;&#x6BB5;&#x7ED9;&#x5B9A;&#x7684;&#x6587;&#x672C;&#x4E2D;&#x81EA;&#x52A8;&#x62BD;&#x53D6;&#x51FA;&#x82E5;&#x5E72;&#x6709;&#x610F;&#x4E49;&#x7684;&#x8BCD;&#x8BED;&#x6216;&#x8BCD;&#x7EC4;&#x3002;<strong>TextRank&#x7B97;&#x6CD5;&#x662F;&#x5229;&#x7528;&#x5C40;&#x90E8;&#x8BCD;&#x6C47;&#x4E4B;&#x95F4;&#x5173;&#x7CFB;&#xFF08;&#x5171;&#x73B0;&#x7A97;&#x53E3;&#xFF09;&#x5BF9;&#x540E;&#x7EED;&#x5173;&#x952E;&#x8BCD;&#x8FDB;&#x884C;&#x6392;&#x5E8F;&#xFF0C;&#x76F4;&#x63A5;&#x4ECE;&#x6587;&#x672C;&#x672C;&#x8EAB;&#x62BD;&#x53D6;</strong></p>
<ul>
<li>&#x5B9A;&#x4E49;:&#x901A;&#x8FC7;&#x8BCD;&#x4E4B;&#x95F4;&#x7684;&#x76F8;&#x90BB;&#x5173;&#x7CFB;&#x6784;&#x5EFA;&#x7F51;&#x7EDC;&#xFF0C;&#x7136;&#x540E;&#x7528;<a href="https://link.zhihu.com/?target=http%3A//www.cnblogs.com/en-heng/p/6124526.html" target="_blank">PageRank</a>&#x8FED;&#x4EE3;&#x8BA1;&#x7B97;&#x6BCF;&#x4E2A;&#x8282;&#x70B9;&#x7684;rank&#x503C;&#xFF0C;&#x6392;&#x5E8F;rank&#x503C;&#x5373;&#x53EF;&#x5F97;&#x5230;&#x5173;&#x952E;&#x8BCD;</li>
<li>&#x65B9;&#x6CD5;&#xFF1A;&#x5229;&#x7528;&#x56FE;&#x6A21;&#x578B;&#x6765;&#x63D0;&#x53D6;&#x6587;&#x7AE0;&#x4E2D;&#x7684;&#x5173;&#x952E;&#x8BCD;</li>
<li>&#x6B65;&#x9AA4;&#xFF1A;</li>
</ul>
<p>&#x57FA;&#x4E8E;TextRank&#x7684;&#x5173;&#x952E;&#x8BCD;&#x63D0;&#x53D6;&#x8FC7;&#x7A0B;&#x6B65;&#x9AA4;&#x5982;&#x4E0B;&#xFF1A;</p>
<ul>
<li>&#x628A;&#x7ED9;&#x5B9A;&#x7684;&#x6587;&#x672C;T&#x6309;&#x7167;&#x5B8C;&#x6574;&#x53E5;&#x5B50;&#x8FDB;&#x884C;&#x5206;&#x5272;&#xFF0C;&#x5BF9;&#x4E8E;&#x6BCF;&#x4E2A;&#x53E5;&#x5B50;&#xFF0C;&#x8FDB;&#x884C;&#x5206;&#x8BCD;&#x548C;&#x8BCD;&#x6027;&#x6807;&#x6CE8;&#x5904;&#x7406;&#xFF0C;&#x5E76;&#x8FC7;&#x6EE4;&#x6389;&#x505C;&#x7528;&#x8BCD;&#xFF0C;&#x53EA;&#x4FDD;&#x7559;&#x6307;&#x5B9A;&#x8BCD;&#x6027;&#x7684;&#x5355;&#x8BCD;&#xFF0C;&#x5982;&#x540D;&#x8BCD;&#x3001;&#x52A8;&#x8BCD;&#x3001;&#x5F62;&#x5BB9;&#x8BCD;&#xFF0C;&#x5373;&#xFF0C;&#x5176;&#x4E2D;&#x662F;&#x4FDD;&#x7559;&#x540E;&#x7684;&#x5019;&#x9009;&#x5173;&#x952E;&#x8BCD;&#x3002;</li>
<li>&#x6784;&#x5EFA;&#x5019;&#x9009;&#x5173;&#x952E;&#x8BCD;&#x56FE;G = (V,E)&#xFF0C;&#x5176;&#x4E2D;V&#x4E3A;&#x8282;&#x70B9;&#x96C6;&#xFF0C;&#x4E0A;&#x4E00;&#x6B65;&#x751F;&#x6210;&#x7684;&#x5019;&#x9009;&#x5173;&#x952E;&#x8BCD;&#x7EC4;&#x6210;&#xFF0C;&#x7136;&#x540E;&#x91C7;&#x7528;&#x5171;&#x73B0;&#x5173;&#x7CFB;&#xFF08;co-occurrence&#xFF09;&#x6784;&#x9020;&#x4EFB;&#x4E24;&#x70B9;&#x4E4B;&#x95F4;&#x7684;&#x8FB9;&#xFF0C;&#x4E24;&#x4E2A;&#x8282;&#x70B9;&#x4E4B;&#x95F4;&#x5B58;&#x5728;&#x8FB9;&#x4EC5;&#x5F53;&#x5B83;&#x4EEC;&#x5BF9;&#x5E94;&#x7684;&#x8BCD;&#x6C47;&#x5728;&#x957F;&#x5EA6;&#x4E3A;K&#x7684;&#x7A97;&#x53E3;&#x4E2D;&#x5171;&#x73B0;&#xFF0C;K&#x8868;&#x793A;&#x7A97;&#x53E3;&#x5927;&#x5C0F;&#xFF0C;&#x5373;&#x6700;&#x591A;&#x5171;&#x73B0;K&#x4E2A;&#x5355;&#x8BCD;&#x3002;&#x6839;&#x636E;&#x4E0A;&#x9762;&#x516C;&#x5F0F;&#xFF0C;&#x8FED;&#x4EE3;&#x4F20;&#x64AD;&#x5404;&#x8282;&#x70B9;&#x7684;&#x6743;&#x91CD;&#xFF0C;&#x76F4;&#x81F3;&#x6536;&#x655B;&#x3002;</li>
<li>&#x5BF9;&#x8282;&#x70B9;&#x6743;&#x91CD;&#x8FDB;&#x884C;&#x5012;&#x5E8F;&#x6392;&#x5E8F;&#xFF0C;&#x4ECE;&#x800C;&#x5F97;&#x5230;&#x6700;&#x91CD;&#x8981;&#x7684;T&#x4E2A;&#x5355;&#x8BCD;&#xFF0C;&#x4F5C;&#x4E3A;&#x5019;&#x9009;&#x5173;&#x952E;&#x8BCD;&#x3002;&#x7B2C;&#x4E8C;&#x90E8;&#x5F97;&#x5230;&#x6700;&#x91CD;&#x8981;&#x7684;T&#x4E2A;&#x5355;&#x8BCD;&#xFF0C;&#x5728;&#x539F;&#x59CB;&#x6587;&#x672C;&#x4E2D;&#x8FDB;&#x884C;&#x6807;&#x8BB0;&#xFF0C;&#x82E5;&#x5F62;&#x6210;&#x76F8;&#x90BB;&#x8BCD;&#x7EC4;&#xFF0C;&#x5219;&#x7EC4;&#x5408;&#x6210;&#x591A;&#x8BCD;&#x5173;&#x952E;&#x8BCD;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x6587;&#x672C;&#x4E2D;&#x6709;&#x53E5;&#x5B50;&#x201C;Matlab code for plotting ambiguity function&#x201D;&#xFF0C;&#x5982;&#x679C;&#x201C;Matlab&#x201D;&#x548C;&#x201C;code&#x201D;&#x5747;&#x5C5E;&#x4E8E;&#x5019;&#x9009;&#x5173;&#x952E;&#x8BCD;&#xFF0C;&#x5219;&#x7EC4;&#x5408;&#x6210;&#x201C;Matlab code&#x201D;&#x52A0;&#x5165;&#x5173;&#x952E;&#x8BCD;&#x5E8F;&#x5217;&#x3002; </li>
</ul>
<p>&#x4F8B;&#x5982;&#x8981;&#x4ECE;&#x4E0B;&#x9762;&#x7684;&#x6587;&#x672C;&#x4E2D;&#x63D0;&#x53D6;&#x5173;&#x952E;&#x8BCD;&#xFF1A;</p>
<blockquote>
<p>&#x7A0B;&#x5E8F;&#x5458;(&#x82F1;&#x6587;Programmer)&#x662F;&#x4ECE;&#x4E8B;&#x7A0B;&#x5E8F;&#x5F00;&#x53D1;&#x3001;&#x7EF4;&#x62A4;&#x7684;&#x4E13;&#x4E1A;&#x4EBA;&#x5458;&#x3002;&#x4E00;&#x822C;&#x5C06;&#x7A0B;&#x5E8F;&#x5458;&#x5206;&#x4E3A;&#x7A0B;&#x5E8F;&#x8BBE;&#x8BA1;&#x4EBA;&#x5458;&#x548C;&#x7A0B;&#x5E8F;&#x7F16;&#x7801;&#x4EBA;&#x5458;&#xFF0C;&#x4F46;&#x4E24;&#x8005;&#x7684;&#x754C;&#x9650;&#x5E76;&#x4E0D;&#x975E;&#x5E38;&#x6E05;&#x695A;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x5728;&#x4E2D;&#x56FD;&#x3002;&#x8F6F;&#x4EF6;&#x4ECE;&#x4E1A;&#x4EBA;&#x5458;&#x5206;&#x4E3A;&#x521D;&#x7EA7;&#x7A0B;&#x5E8F;&#x5458;&#x3001;&#x9AD8;&#x7EA7;&#x7A0B;&#x5E8F;&#x5458;&#x3001;&#x7CFB;&#x7EDF;&#x5206;&#x6790;&#x5458;&#x548C;&#x9879;&#x76EE;&#x7ECF;&#x7406;&#x56DB;&#x5927;&#x7C7B;&#x3002;</p>
</blockquote>
<p>&#x5BF9;&#x8FD9;&#x53E5;&#x8BDD;&#x5206;&#x8BCD;&#xFF0C;&#x53BB;&#x6389;&#x91CC;&#x9762;&#x7684;&#x505C;&#x7528;&#x8BCD;&#xFF0C;&#x7136;&#x540E;&#x4FDD;&#x7559;&#x8BCD;&#x6027;&#x4E3A;&#x540D;&#x8BCD;&#x3001;&#x52A8;&#x8BCD;&#x3001;&#x5F62;&#x5BB9;&#x8BCD;&#x3001;&#x526F;&#x8BCD;&#x7684;&#x5355;&#x8BCD;&#x3002;&#x5F97;&#x51FA;&#x5B9E;&#x9645;&#x6709;&#x7528;&#x7684;&#x8BCD;&#x8BED;&#xFF1A;</p>
<blockquote>
<p>&#x7A0B;&#x5E8F;&#x5458;, &#x82F1;&#x6587;, &#x7A0B;&#x5E8F;, &#x5F00;&#x53D1;, &#x7EF4;&#x62A4;, &#x4E13;&#x4E1A;, &#x4EBA;&#x5458;, &#x7A0B;&#x5E8F;&#x5458;, &#x5206;&#x4E3A;, &#x7A0B;&#x5E8F;, &#x8BBE;&#x8BA1;, &#x4EBA;&#x5458;, &#x7A0B;&#x5E8F;, &#x7F16;&#x7801;, &#x4EBA;&#x5458;, &#x754C;&#x9650;, &#x7279;&#x522B;, &#x4E2D;&#x56FD;, &#x8F6F;&#x4EF6;, &#x4EBA;&#x5458;, &#x5206;&#x4E3A;, &#x7A0B;&#x5E8F;&#x5458;, &#x9AD8;&#x7EA7;, &#x7A0B;&#x5E8F;&#x5458;, &#x7CFB;&#x7EDF;, &#x5206;&#x6790;&#x5458;, &#x9879;&#x76EE;, &#x7ECF;&#x7406;</p>
</blockquote>
<p>&#x73B0;&#x5728;&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A;&#x5927;&#x5C0F;&#x4E3A; 9 &#x7684;&#x7A97;&#x53E3;&#xFF0C;&#x5373;&#x76F8;&#x5F53;&#x4E8E;&#x6BCF;&#x4E2A;&#x5355;&#x8BCD;&#x8981;&#x5C06;&#x7968;&#x6295;&#x7ED9;&#x5B83;&#x8EAB;&#x524D;&#x8EAB;&#x540E;&#x8DDD;&#x79BB; 5 &#x4EE5;&#x5185;&#x7684;&#x5355;&#x8BCD;&#xFF1A;</p>
<pre><code>&#x5F00;&#x53D1;=[&#x4E13;&#x4E1A;, &#x7A0B;&#x5E8F;&#x5458;, &#x7EF4;&#x62A4;, &#x82F1;&#x6587;, &#x7A0B;&#x5E8F;, &#x4EBA;&#x5458;]
&#x8F6F;&#x4EF6;=[&#x7A0B;&#x5E8F;&#x5458;, &#x5206;&#x4E3A;, &#x754C;&#x9650;, &#x9AD8;&#x7EA7;, &#x4E2D;&#x56FD;, &#x7279;&#x522B;, &#x4EBA;&#x5458;]
&#x7A0B;&#x5E8F;&#x5458;=[&#x5F00;&#x53D1;, &#x8F6F;&#x4EF6;, &#x5206;&#x6790;&#x5458;, &#x7EF4;&#x62A4;, &#x7CFB;&#x7EDF;, &#x9879;&#x76EE;, &#x7ECF;&#x7406;, &#x5206;&#x4E3A;, &#x82F1;&#x6587;, &#x7A0B;&#x5E8F;, &#x4E13;&#x4E1A;, &#x8BBE;&#x8BA1;, &#x9AD8;&#x7EA7;, &#x4EBA;&#x5458;, &#x4E2D;&#x56FD;]
&#x5206;&#x6790;&#x5458;=[&#x7A0B;&#x5E8F;&#x5458;, &#x7CFB;&#x7EDF;, &#x9879;&#x76EE;, &#x7ECF;&#x7406;, &#x9AD8;&#x7EA7;]
&#x7EF4;&#x62A4;=[&#x4E13;&#x4E1A;, &#x5F00;&#x53D1;, &#x7A0B;&#x5E8F;&#x5458;, &#x5206;&#x4E3A;, &#x82F1;&#x6587;, &#x7A0B;&#x5E8F;, &#x4EBA;&#x5458;]
&#x7CFB;&#x7EDF;=[&#x7A0B;&#x5E8F;&#x5458;, &#x5206;&#x6790;&#x5458;, &#x9879;&#x76EE;, &#x7ECF;&#x7406;, &#x5206;&#x4E3A;, &#x9AD8;&#x7EA7;]
&#x9879;&#x76EE;=[&#x7A0B;&#x5E8F;&#x5458;, &#x5206;&#x6790;&#x5458;, &#x7CFB;&#x7EDF;, &#x7ECF;&#x7406;, &#x9AD8;&#x7EA7;]
&#x7ECF;&#x7406;=[&#x7A0B;&#x5E8F;&#x5458;, &#x5206;&#x6790;&#x5458;, &#x7CFB;&#x7EDF;, &#x9879;&#x76EE;]
&#x5206;&#x4E3A;=[&#x4E13;&#x4E1A;, &#x8F6F;&#x4EF6;, &#x8BBE;&#x8BA1;, &#x7A0B;&#x5E8F;&#x5458;, &#x7EF4;&#x62A4;, &#x7CFB;&#x7EDF;, &#x9AD8;&#x7EA7;, &#x7A0B;&#x5E8F;, &#x4E2D;&#x56FD;, &#x7279;&#x522B;, &#x4EBA;&#x5458;]
&#x82F1;&#x6587;=[&#x4E13;&#x4E1A;, &#x5F00;&#x53D1;, &#x7A0B;&#x5E8F;&#x5458;, &#x7EF4;&#x62A4;, &#x7A0B;&#x5E8F;]
&#x7A0B;&#x5E8F;=[&#x4E13;&#x4E1A;, &#x5F00;&#x53D1;, &#x8BBE;&#x8BA1;, &#x7A0B;&#x5E8F;&#x5458;, &#x7F16;&#x7801;, &#x7EF4;&#x62A4;, &#x754C;&#x9650;, &#x5206;&#x4E3A;, &#x82F1;&#x6587;, &#x7279;&#x522B;, &#x4EBA;&#x5458;]
&#x7279;&#x522B;=[&#x8F6F;&#x4EF6;, &#x7F16;&#x7801;, &#x5206;&#x4E3A;, &#x754C;&#x9650;, &#x7A0B;&#x5E8F;, &#x4E2D;&#x56FD;, &#x4EBA;&#x5458;]
&#x4E13;&#x4E1A;=[&#x5F00;&#x53D1;, &#x7A0B;&#x5E8F;&#x5458;, &#x7EF4;&#x62A4;, &#x5206;&#x4E3A;, &#x82F1;&#x6587;, &#x7A0B;&#x5E8F;, &#x4EBA;&#x5458;]
&#x8BBE;&#x8BA1;=[&#x7A0B;&#x5E8F;&#x5458;, &#x7F16;&#x7801;, &#x5206;&#x4E3A;, &#x7A0B;&#x5E8F;, &#x4EBA;&#x5458;]
&#x7F16;&#x7801;=[&#x8BBE;&#x8BA1;, &#x754C;&#x9650;, &#x7A0B;&#x5E8F;, &#x4E2D;&#x56FD;, &#x7279;&#x522B;, &#x4EBA;&#x5458;]
&#x754C;&#x9650;=[&#x8F6F;&#x4EF6;, &#x7F16;&#x7801;, &#x7A0B;&#x5E8F;, &#x4E2D;&#x56FD;, &#x7279;&#x522B;, &#x4EBA;&#x5458;]
&#x9AD8;&#x7EA7;=[&#x7A0B;&#x5E8F;&#x5458;, &#x8F6F;&#x4EF6;, &#x5206;&#x6790;&#x5458;, &#x7CFB;&#x7EDF;, &#x9879;&#x76EE;, &#x5206;&#x4E3A;, &#x4EBA;&#x5458;]
&#x4E2D;&#x56FD;=[&#x7A0B;&#x5E8F;&#x5458;, &#x8F6F;&#x4EF6;, &#x7F16;&#x7801;, &#x5206;&#x4E3A;, &#x754C;&#x9650;, &#x7279;&#x522B;, &#x4EBA;&#x5458;]
&#x4EBA;&#x5458;=[&#x5F00;&#x53D1;, &#x7A0B;&#x5E8F;&#x5458;, &#x8F6F;&#x4EF6;, &#x7EF4;&#x62A4;, &#x5206;&#x4E3A;, &#x7A0B;&#x5E8F;, &#x7279;&#x522B;, &#x4E13;&#x4E1A;, &#x8BBE;&#x8BA1;, &#x7F16;&#x7801;, &#x754C;&#x9650;, &#x9AD8;&#x7EA7;, &#x4E2D;&#x56FD;]
</code></pre><p>&#x7136;&#x540E;&#x5F00;&#x59CB;&#x8FED;&#x4EE3;&#x6295;&#x7968;&#xFF0C;&#x76F4;&#x81F3;&#x6536;&#x655B;&#xFF1A;</p>
<pre><code>&#x7A0B;&#x5E8F;&#x5458;=1.9249977,
&#x4EBA;&#x5458;=1.6290349,
&#x5206;&#x4E3A;=1.4027836,
&#x7A0B;&#x5E8F;=1.4025855,
&#x9AD8;&#x7EA7;=0.9747374,
&#x8F6F;&#x4EF6;=0.93525416,
&#x4E2D;&#x56FD;=0.93414587,
&#x7279;&#x522B;=0.93352026,
&#x7EF4;&#x62A4;=0.9321688,
&#x4E13;&#x4E1A;=0.9321688,
&#x7CFB;&#x7EDF;=0.885048,
&#x7F16;&#x7801;=0.82671607,
&#x754C;&#x9650;=0.82206935,
&#x5F00;&#x53D1;=0.82074183,
&#x5206;&#x6790;&#x5458;=0.77101076,
&#x9879;&#x76EE;=0.77101076,
&#x82F1;&#x6587;=0.7098714,
&#x8BBE;&#x8BA1;=0.6992446,
&#x7ECF;&#x7406;=0.64640945
</code></pre><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x201C;&#x7A0B;&#x5E8F;&#x5458;&#x201D;&#x7684;&#x5F97;&#x7968;&#x6570;&#x6700;&#x591A;&#xFF0C;&#x56E0;&#x800C;&#x5B83;&#x662F;&#x6574;&#x6BB5;&#x6587;&#x672C;&#x6700;&#x91CD;&#x8981;&#x7684;&#x5355;&#x8BCD;&#x3002;&#x6211;&#x4EEC;&#x5C06;&#x6587;&#x672C;&#x4E2D;&#x5F97;&#x7968;&#x6570;&#x591A;&#x7684;&#x82E5;&#x5E72;&#x5355;&#x8BCD;&#x4F5C;&#x4E3A;&#x8BE5;&#x6BB5;&#x6587;&#x672C;&#x7684;&#x5173;&#x952E;&#x8BCD;&#xFF0C;&#x82E5;&#x591A;&#x4E2A;&#x5173;&#x952E;&#x8BCD;&#x76F8;&#x90BB;&#xFF0C;&#x8FD9;&#x4E9B;&#x5173;&#x952E;&#x8BCD;&#x8FD8;&#x53EF;&#x4EE5;&#x6784;&#x6210;&#x5173;&#x952E;&#x77ED;&#x8BED;&#x3002;&#x8BCD;&#x6027;&#xFF1A;</p>
<p><img src="../images/textrank&#x8BCD;&#x6027;.png" alt=""></p>
<ul>
<li>&#x5173;&#x952E;&#x8BCD;&#x8BC4;&#x5206;</li>
</ul>
<p>PageRank&#x7B97;&#x6CD5;&#xFF1A;</p>
<p>&#x672C;&#x7B97;&#x6CD5;&#x662F;&#x7531;&#x8C37;&#x6B4C;&#x7684;&#x4E24;&#x4F4D;&#x521B;&#x59CB;&#x4EBA;&#x4F69;&#x5947;(Larry Page)&#x548C;&#x5E03;&#x6797;(Sergey Brin)&#x53C2;&#x8003;&#x5B66;&#x672F;&#x754C;&#x8BC4;&#x5224;&#x5B66;&#x672F;&#x8BBA;&#x6587;&#x91CD;&#x8981;&#x6027;&#x7684;&#x65B9;&#x6CD5;&#x2014;&#x2014;&#x2014;&#x770B;&#x8BBA;&#x6587;&#x7684;&#x5F15;&#x7528;&#x6B21;&#x6570; &#x800C;&#x63D0;&#x51FA;&#xFF0C;&#x7B97;&#x6CD5;&#x601D;&#x60F3;&#xFF1A;</p>
<ul>
<li>&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x7F51;&#x9875;&#x88AB;&#x5F88;&#x591A;&#x5176;&#x4ED6;&#x7F51;&#x9875;&#x94FE;&#x63A5;&#x5230;&#x7684;&#x8BDD;&#x8BF4;&#x660E;&#x8FD9;&#x4E2A;&#x7F51;&#x9875;&#x6BD4;&#x8F83;&#x91CD;&#x8981;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;PageRank&#x503C;&#x4F1A;&#x76F8;&#x5BF9;&#x8F83;&#x9AD8;</li>
<li>&#x5982;&#x679C;&#x4E00;&#x4E2A;PageRank&#x503C;&#x5F88;&#x9AD8;&#x7684;&#x7F51;&#x9875;&#x94FE;&#x63A5;&#x5230;&#x4E00;&#x4E2A;&#x5176;&#x4ED6;&#x7684;&#x7F51;&#x9875;&#xFF0C;&#x90A3;&#x4E48;&#x88AB;&#x94FE;&#x63A5;&#x5230;&#x7684;&#x7F51;&#x9875;&#x7684;PageRank&#x503C;&#x4F1A;&#x76F8;&#x5E94;&#x5730;&#x56E0;&#x6B64;&#x800C;&#x63D0;&#x9AD8;</li>
</ul>
<p><img src="../images/&#x7F51;&#x9875;pagerank.png" alt=""></p>
<p>&#x5982;&#xFF1A;</p>
<p><img src="../images/&#x8BCD;&#x7684;&#x65E0;&#x5411;&#x56FE;.png" alt=""></p>
<h4 id="2431-&#x6587;&#x7AE0;&#x7684;textrank&#x8BA1;&#x7B97;">2.4.3.1 &#x6587;&#x7AE0;&#x7684;TextRank&#x8BA1;&#x7B97;</h4>
<p>&#x6B65;&#x9AA4;:</p>
<ul>
<li>1&#x3001;TextRank&#x5B58;&#x50A8;&#x7ED3;&#x6784;</li>
<li>2&#x3001;TextRank&#x8FC7;&#x6EE4;&#x8BA1;&#x7B97;</li>
</ul>
<p>&#x521B;&#x5EFA;textrank_keywords_values&#x8868;</p>
<pre><code class="lang-mysql">CREATE TABLE textrank_keywords_values(
article_id INT comment &quot;article_id&quot;,
channel_id INT comment &quot;channel_id&quot;,
keyword STRING comment &quot;keyword&quot;,
textrank DOUBLE comment &quot;textrank&quot;);
</code></pre>
<p>&#x8FDB;&#x884C;&#x8BCD;&#x7684;&#x5904;&#x7406;&#x4E0E;&#x5B58;&#x50A8;</p>
<pre><code class="lang-python"><span class="hljs-comment"># &#x8BA1;&#x7B97;textrank</span>
textrank_keywords_df = article_dataframe.rdd.mapPartitions(textrank).toDF(
[<span class="hljs-string">&quot;article_id&quot;</span>, <span class="hljs-string">&quot;channel_id&quot;</span>, <span class="hljs-string">&quot;keyword&quot;</span>, <span class="hljs-string">&quot;textrank&quot;</span>])

<span class="hljs-comment"># textrank_keywords_df.write.insertInto(&quot;textrank_keywords_values&quot;)</span>
</code></pre>
<p>&#x5206;&#x8BCD;&#x7ED3;&#x679C;&#xFF1A;</p>
<pre><code class="lang-python"><span class="hljs-comment"># &#x5206;&#x8BCD;</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">textrank</span><span class="hljs-params">(partition)</span>:</span>
    <span class="hljs-keyword">import</span> os

    <span class="hljs-keyword">import</span> jieba
    <span class="hljs-keyword">import</span> jieba.analyse
    <span class="hljs-keyword">import</span> jieba.posseg <span class="hljs-keyword">as</span> pseg
    <span class="hljs-keyword">import</span> codecs

    abspath = <span class="hljs-string">&quot;/root/words&quot;</span>

    <span class="hljs-comment"># &#x7ED3;&#x5DF4;&#x52A0;&#x8F7D;&#x7528;&#x6237;&#x8BCD;&#x5178;</span>
    userDict_path = os.path.join(abspath, <span class="hljs-string">&quot;ITKeywords.txt&quot;</span>)
    jieba.load_userdict(userDict_path)

    <span class="hljs-comment"># &#x505C;&#x7528;&#x8BCD;&#x6587;&#x672C;</span>
    stopwords_path = os.path.join(abspath, <span class="hljs-string">&quot;stopwords.txt&quot;</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_stopwords_list</span><span class="hljs-params">()</span>:</span>
        <span class="hljs-string">&quot;&quot;&quot;&#x8FD4;&#x56DE;stopwords&#x5217;&#x8868;&quot;&quot;&quot;</span>
        stopwords_list = [i.strip()
                          <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> codecs.open(stopwords_path).readlines()]
        <span class="hljs-keyword">return</span> stopwords_list

    <span class="hljs-comment"># &#x6240;&#x6709;&#x7684;&#x505C;&#x7528;&#x8BCD;&#x5217;&#x8868;</span>
    stopwords_list = get_stopwords_list()

    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TextRank</span><span class="hljs-params">(jieba.analyse.TextRank)</span>:</span>
        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, window=<span class="hljs-number">20</span>, word_min_len=<span class="hljs-number">2</span>)</span>:</span>
            super(TextRank, self).__init__()
            self.span = window  <span class="hljs-comment"># &#x7A97;&#x53E3;&#x5927;&#x5C0F;</span>
            self.word_min_len = word_min_len  <span class="hljs-comment"># &#x5355;&#x8BCD;&#x7684;&#x6700;&#x5C0F;&#x957F;&#x5EA6;</span>
            <span class="hljs-comment"># &#x8981;&#x4FDD;&#x7559;&#x7684;&#x8BCD;&#x6027;&#xFF0C;&#x6839;&#x636E;jieba github &#xFF0C;&#x5177;&#x4F53;&#x53C2;&#x89C1;https://github.com/baidu/lac</span>
            self.pos_filt = frozenset(
                (<span class="hljs-string">&apos;n&apos;</span>, <span class="hljs-string">&apos;x&apos;</span>, <span class="hljs-string">&apos;eng&apos;</span>, <span class="hljs-string">&apos;f&apos;</span>, <span class="hljs-string">&apos;s&apos;</span>, <span class="hljs-string">&apos;t&apos;</span>, <span class="hljs-string">&apos;nr&apos;</span>, <span class="hljs-string">&apos;ns&apos;</span>, <span class="hljs-string">&apos;nt&apos;</span>, <span class="hljs-string">&quot;nw&quot;</span>, <span class="hljs-string">&quot;nz&quot;</span>, <span class="hljs-string">&quot;PER&quot;</span>, <span class="hljs-string">&quot;LOC&quot;</span>, <span class="hljs-string">&quot;ORG&quot;</span>))

        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">pairfilter</span><span class="hljs-params">(self, wp)</span>:</span>
            <span class="hljs-string">&quot;&quot;&quot;&#x8FC7;&#x6EE4;&#x6761;&#x4EF6;&#xFF0C;&#x8FD4;&#x56DE;True&#x6216;&#x8005;False&quot;&quot;&quot;</span>

            <span class="hljs-keyword">if</span> wp.flag == <span class="hljs-string">&quot;eng&quot;</span>:
                <span class="hljs-keyword">if</span> len(wp.word) &lt;= <span class="hljs-number">2</span>:
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">False</span>

            <span class="hljs-keyword">if</span> wp.flag <span class="hljs-keyword">in</span> self.pos_filt <span class="hljs-keyword">and</span> len(wp.word.strip()) &gt;= self.word_min_len \
                    <span class="hljs-keyword">and</span> wp.word.lower() <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> stopwords_list:
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">True</span>
    <span class="hljs-comment"># TextRank&#x8FC7;&#x6EE4;&#x7A97;&#x53E3;&#x5927;&#x5C0F;&#x4E3A;5&#xFF0C;&#x5355;&#x8BCD;&#x6700;&#x5C0F;&#x4E3A;2</span>
    textrank_model = TextRank(window=<span class="hljs-number">5</span>, word_min_len=<span class="hljs-number">2</span>)
    allowPOS = (<span class="hljs-string">&apos;n&apos;</span>, <span class="hljs-string">&quot;x&quot;</span>, <span class="hljs-string">&apos;eng&apos;</span>, <span class="hljs-string">&apos;nr&apos;</span>, <span class="hljs-string">&apos;ns&apos;</span>, <span class="hljs-string">&apos;nt&apos;</span>, <span class="hljs-string">&quot;nw&quot;</span>, <span class="hljs-string">&quot;nz&quot;</span>, <span class="hljs-string">&quot;c&quot;</span>)

    <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> partition:
        tags = textrank_model.textrank(row.sentence, topK=<span class="hljs-number">20</span>, withWeight=<span class="hljs-keyword">True</span>, allowPOS=allowPOS, withFlag=<span class="hljs-keyword">False</span>)
        <span class="hljs-keyword">for</span> tag <span class="hljs-keyword">in</span> tags:
            <span class="hljs-keyword">yield</span> row.article_id, row.channel_id, tag[<span class="hljs-number">0</span>], tag[<span class="hljs-number">1</span>]
</code></pre>
<p>&#x6700;&#x7EC8;&#x5B58;&#x50A8;&#x4E3A;&#xFF1A;</p>
<pre><code class="lang-mysql">hive&gt; select * from textrank_keywords_values limit 20;
OK
98319   17      var     20.6079
98323   17      var     7.4938
98326   17      var     104.9128
98344   17      var     5.6203
98359   17      var     69.3174
98360   17      var     9.3672
98392   17      var     14.9875
98393   17      var     155.4958
98406   17      var     11.2407
98419   17      var     59.9502
98442   17      var     18.7344
98445   17      var     37.4689
98512   17      var     29.9751
98544   17      var     5.6203
98545   17      var     22.4813
98548   17      var     71.1909
98599   17      var     11.2407
98609   17      var     18.7344
98642   17      var     67.444
98648   15      var     20.6079
Time taken: 0.344 seconds, Fetched: 20 row(s)
hive&gt; desc textrank_keywords_values;
OK
article_id              int                     article_id          
channel_id              int                     channel_id          
keyword                 string                  keyword             
textrank                double                  textrank
</code></pre>
<h3 id="253-&#x6587;&#x7AE0;&#x753B;&#x50CF;&#x7ED3;&#x679C;">2.5.3 &#x6587;&#x7AE0;&#x753B;&#x50CF;&#x7ED3;&#x679C;</h3>
<p>&#x5BF9;&#x6587;&#x7AE0;&#x8FDB;&#x884C;&#x8BA1;&#x7B97;&#x753B;&#x50CF;</p>
<ul>
<li>&#x6B65;&#x9AA4;&#xFF1A;<ul>
<li>1&#x3001;&#x52A0;&#x8F7D;IDF&#xFF0C;&#x4FDD;&#x7559;&#x5173;&#x952E;&#x8BCD;&#x4EE5;&#x53CA;&#x6743;&#x91CD;&#x8BA1;&#x7B97;(TextRank * IDF)</li>
<li>2&#x3001;&#x5408;&#x5E76;&#x5173;&#x952E;&#x8BCD;&#x6743;&#x91CD;&#x5230;&#x5B57;&#x5178;&#x7ED3;&#x679C;</li>
<li>3&#x3001;&#x5C06;tfidf&#x548C;textrank&#x5171;&#x73B0;&#x7684;&#x8BCD;&#x4F5C;&#x4E3A;&#x4E3B;&#x9898;&#x8BCD;</li>
<li>4&#x3001;&#x5C06;&#x4E3B;&#x9898;&#x8BCD;&#x8868;&#x548C;&#x5173;&#x952E;&#x8BCD;&#x8868;&#x8FDB;&#x884C;&#x5408;&#x5E76;&#xFF0C;&#x63D2;&#x5165;&#x8868;</li>
</ul>
</li>
</ul>
<p><strong>&#x52A0;&#x8F7D;IDF&#xFF0C;&#x4FDD;&#x7559;&#x5173;&#x952E;&#x8BCD;&#x4EE5;&#x53CA;&#x6743;&#x91CD;&#x8BA1;&#x7B97;(TextRank * IDF)</strong></p>
<pre><code class="lang-python">idf = ktt.spark.sql(<span class="hljs-string">&quot;select * from idf_keywords_values&quot;</span>)
idf = idf.withColumnRenamed(<span class="hljs-string">&quot;keyword&quot;</span>, <span class="hljs-string">&quot;keyword1&quot;</span>)
result = textrank_keywords_df.join(idf,textrank_keywords_df.keyword==idf.keyword1)
keywords_res = result.withColumn(<span class="hljs-string">&quot;weights&quot;</span>, result.textrank * result.idf).select([<span class="hljs-string">&quot;article_id&quot;</span>, <span class="hljs-string">&quot;channel_id&quot;</span>, <span class="hljs-string">&quot;keyword&quot;</span>, <span class="hljs-string">&quot;weights&quot;</span>])
</code></pre>
<p><strong>&#x5408;&#x5E76;&#x5173;&#x952E;&#x8BCD;&#x6743;&#x91CD;&#x5230;&#x5B57;&#x5178;&#x7ED3;&#x679C;</strong></p>
<pre><code class="lang-python">keywords_res.registerTempTable(<span class="hljs-string">&quot;temptable&quot;</span>)
merge_keywords = ktt.spark.sql(<span class="hljs-string">&quot;select article_id, min(channel_id) channel_id, collect_list(keyword) keywords, collect_list(weights) weights from temptable group by article_id&quot;</span>)

<span class="hljs-comment"># &#x5408;&#x5E76;&#x5173;&#x952E;&#x8BCD;&#x6743;&#x91CD;&#x5408;&#x5E76;&#x6210;&#x5B57;&#x5178;</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_func</span><span class="hljs-params">(row)</span>:</span>
    <span class="hljs-keyword">return</span> row.article_id, row.channel_id, dict(zip(row.keywords, row.weights))

keywords_info = merge_keywords.rdd.map(_func).toDF([<span class="hljs-string">&quot;article_id&quot;</span>, <span class="hljs-string">&quot;channel_id&quot;</span>, <span class="hljs-string">&quot;keywords&quot;</span>])
</code></pre>
<p><strong>&#x5C06;tfidf&#x548C;textrank&#x5171;&#x73B0;&#x7684;&#x8BCD;&#x4F5C;&#x4E3A;&#x4E3B;&#x9898;&#x8BCD;</strong></p>
<pre><code class="lang-python">topic_sql = <span class="hljs-string">&quot;&quot;&quot;
                select t.article_id article_id2, collect_set(t.keyword) topics from tfidf_keywords_values t
                inner join 
                textrank_keywords_values r
                where t.keyword=r.keyword
                group by article_id2
                &quot;&quot;&quot;</span>
article_topics = ktt.spark.sql(topic_sql)
</code></pre>
<p><strong>&#x5C06;&#x4E3B;&#x9898;&#x8BCD;&#x8868;&#x548C;&#x5173;&#x952E;&#x8BCD;&#x8868;&#x8FDB;&#x884C;&#x5408;&#x5E76;</strong></p>
<pre><code class="lang-python">article_profile = keywords_info.join(article_topics, keywords_info.article_id==article_topics.article_id2).select([<span class="hljs-string">&quot;article_id&quot;</span>, <span class="hljs-string">&quot;channel_id&quot;</span>, <span class="hljs-string">&quot;keywords&quot;</span>, <span class="hljs-string">&quot;topics&quot;</span>])

<span class="hljs-comment"># articleProfile.write.insertInto(&quot;article_profile&quot;)</span>
</code></pre>
<p>&#x7ED3;&#x679C;&#x663E;&#x793A;</p>
<pre><code class="lang-python">hive&gt; select * <span class="hljs-keyword">from</span> article_profile limit <span class="hljs-number">1</span>;
OK
<span class="hljs-number">26</span>      <span class="hljs-number">17</span>      {<span class="hljs-string">&quot;&#x7B56;&#x7565;&quot;</span>:<span class="hljs-number">0.3973770571351729</span>,<span class="hljs-string">&quot;jpg&quot;</span>:<span class="hljs-number">0.9806348975390871</span>,<span class="hljs-string">&quot;&#x7528;&#x6237;&quot;</span>:<span class="hljs-number">1.2794959063944176</span>,<span class="hljs-string">&quot;strong&quot;</span>:<span class="hljs-number">1.6488457985625076</span>,<span class="hljs-string">&quot;&#x6587;&#x4EF6;&quot;</span>:<span class="hljs-number">0.28144603583387057</span>,<span class="hljs-string">&quot;&#x903B;&#x8F91;&quot;</span>:<span class="hljs-number">0.45256526469610714</span>,<span class="hljs-string">&quot;&#x5F62;&#x5F0F;&quot;</span>:<span class="hljs-number">0.4123994242601279</span>,<span class="hljs-string">&quot;&#x5168;&#x81EA;&quot;</span>:<span class="hljs-number">0.9594604850547191</span>,<span class="hljs-string">&quot;h2&quot;</span>:<span class="hljs-number">0.6244481634710125</span>,<span class="hljs-string">&quot;&#x7248;&#x672C;&quot;</span>:<span class="hljs-number">0.44280276959510817</span>,<span class="hljs-string">&quot;Adobe&quot;</span>:<span class="hljs-number">0.8553618185108718</span>,<span class="hljs-string">&quot;&#x5B89;&#x88C5;&quot;</span>:<span class="hljs-number">0.8305037437573172</span>,<span class="hljs-string">&quot;&#x68C0;&#x67E5;&#x66F4;&#x65B0;&quot;</span>:<span class="hljs-number">1.8088946300014435</span>,<span class="hljs-string">&quot;&#x4EA7;&#x54C1;&quot;</span>:<span class="hljs-number">0.774842382276899</span>,<span class="hljs-string">&quot;&#x4E0B;&#x8F7D;&#x9875;&quot;</span>:<span class="hljs-number">1.4256311032544344</span>,<span class="hljs-string">&quot;&#x8FC7;&#x7A0B;&quot;</span>:<span class="hljs-number">0.19827163395829256</span>,<span class="hljs-string">&quot;json&quot;</span>:<span class="hljs-number">0.6423301791599972</span>,<span class="hljs-string">&quot;&#x65B9;&#x5F0F;&quot;</span>:<span class="hljs-number">0.582762869780791</span>,<span class="hljs-string">&quot;&#x9000;&#x51FA;&#x5E94;&#x7528;&quot;</span>:<span class="hljs-number">1.2338671268242603</span>,<span class="hljs-string">&quot;Setup&quot;</span>:<span class="hljs-number">1.004399549339134</span>}   [<span class="hljs-string">&quot;Electron&quot;</span>,<span class="hljs-string">&quot;&#x5168;&#x81EA;&#x52A8;&quot;</span>,<span class="hljs-string">&quot;&#x4EA7;&#x54C1;&quot;</span>,<span class="hljs-string">&quot;&#x7248;&#x672C;&#x53F7;&quot;</span>,<span class="hljs-string">&quot;&#x5B89;&#x88C5;&#x5305;&quot;</span>,<span class="hljs-string">&quot;&#x68C0;&#x67E5;&#x66F4;&#x65B0;&quot;</span>,<span class="hljs-string">&quot;&#x65B9;&#x6848;&quot;</span>,<span class="hljs-string">&quot;&#x7248;&#x672C;&quot;</span>,<span class="hljs-string">&quot;&#x9000;&#x51FA;&#x5E94;&#x7528;&quot;</span>,<span class="hljs-string">&quot;&#x903B;&#x8F91;&quot;</span>,<span class="hljs-string">&quot;&#x5B89;&#x88C5;&#x8FC7;&#x7A0B;&quot;</span>,<span class="hljs-string">&quot;&#x65B9;&#x5F0F;&quot;</span>,<span class="hljs-string">&quot;&#x5B9A;&#x6027;&quot;</span>,<span class="hljs-string">&quot;&#x65B0;&#x7248;&#x672C;&quot;</span>,<span class="hljs-string">&quot;Setup&quot;</span>,<span class="hljs-string">&quot;&#x9759;&#x9ED8;&quot;</span>,<span class="hljs-string">&quot;&#x7528;&#x6237;&quot;</span>]
Time taken: <span class="hljs-number">0.322</span> seconds, Fetched: <span class="hljs-number">1</span> row(s)
</code></pre>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../day01/section2.html" class="navigation navigation-prev " aria-label="Previous page: 离线画像业务介绍"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../day01/section4.html" class="navigation navigation-next " aria-label="Next page: 离线增量画像更新代码"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="../gitbook/plugins/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-livereload/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"katex":{},"expandable-chapters-small":{},"highlight":{},"search":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"livereload":{}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
